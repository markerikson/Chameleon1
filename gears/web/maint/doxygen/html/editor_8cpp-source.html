<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Chameleon: editor.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>editor.cpp</h1><a href="editor_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre><a name="l00001"></a><a class="code" href="editor_8cpp.html#a0">00001</a> <span class="preprocessor">#define CRTDBG_MAP_ALLOC</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00003 <span class="preprocessor">#include &lt;crtdbg.h&gt;</span>
00004 
00005 <span class="preprocessor">#include "../common/CommonHeaders.h"</span>
00006 
00007 <span class="preprocessor">#include &lt;wx/datetime.h&gt;</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="editor_8h.html">editor.h</a>"</span>
00010 <span class="preprocessor">#include "../perms/p.h"</span>
00011 <span class="preprocessor">#include "../gui/ChameleonWindow.h"</span>
00012 <span class="preprocessor">#include "../gui/ChameleonNotebook.h"</span>
00013 <span class="preprocessor">#include "../common/datastructures.h"</span>
00014 <span class="preprocessor">#include "../common/Options.h"</span>
00015 <span class="preprocessor">#include "../common/DebugEvent.h"</span>
00016 <span class="preprocessor">#include "../common/ProjectInfo.h"</span>
00017 <span class="preprocessor">#include "../common/debug.h"</span>
00018 <span class="preprocessor">#include "../common/fixvsbug.h"</span>
00019 
00020 <span class="preprocessor">#ifdef _DEBUG</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#define new DEBUG_NEW</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00023 <span class="preprocessor"></span>
00024 
00025 BEGIN_EVENT_TABLE(<a class="code" href="class_chameleon_editor.html">ChameleonEditor</a>, wxStyledTextCtrl)
00026     EVT_STC_CHARADDED(-1, ChameleonEditor::OnChar)
00027     EVT_STC_MODIFIED(-1, ChameleonEditor::OnEditorModified)
00028     EVT_RIGHT_DOWN      (ChameleonEditor::OnRightClick)
00029     EVT_MENU            (ID_DEBUG_ADD_BREAKPOINT, ChameleonEditor::OnAddBreakpoint)
00030     EVT_MENU            (ID_DEBUG_REMOVE_BREAKPOINT, ChameleonEditor::OnRemoveBreakpoint)
00031     EVT_MENU            (ID_DEBUG_CLEAR_ALL_BREAKPOINTS, ChameleonEditor::OnClearBreakpoints)
00032     <span class="comment">//EVT_COMPILER_END  (ChameleonEditor::OnCompilerEnded)</span>
00033     EVT_MENU            (ID_DEBUG_RUNTOCURSOR, ChameleonEditor::OnRunToCursor)
00034 END_EVENT_TABLE()
00035 
<a name="l00036"></a><a class="code" href="editor_8cpp.html#a1">00036</a> <span class="keywordtype">int</span> <a class="code" href="editor_8cpp.html#a1">CompareInts</a>(<span class="keywordtype">int</span> n1, <span class="keywordtype">int</span> n2)
00037 {
00038     <span class="keywordflow">return</span> n1 - n2;
00039 }
00040 
00041 
00042 
00043 
<a name="l00057"></a><a class="code" href="class_chameleon_editor.html#a0">00057</a> <a class="code" href="class_chameleon_editor.html#a0">ChameleonEditor::ChameleonEditor</a>( <a class="code" href="class_chameleon_window.html">ChameleonWindow</a> *mframe,
00058                                  <a class="code" href="class_options.html">Options</a>* options,
00059                                  <a class="code" href="class_project_info.html">ProjectInfo</a>* project,
00060                                   wxWindow *parent,     wxWindowID <span class="keywordtype">id</span>, <span class="keyword">const</span>
00061                                       wxPoint &amp; pos <span class="comment">/* = wxDefaultPosition */</span>,
00062                                   <span class="keyword">const</span> wxSize &amp; size <span class="comment">/* = wxDefaultSize */</span>,
00063                                   <span class="keywordtype">long</span> style <span class="comment">/* = 0 */</span>, <span class="keyword">const</span>
00064                                       wxString &amp; name <span class="comment">/* = wxSTCNameStr */</span> ) :
00065     wxStyledTextCtrl(parent, id, pos, size, style, name)
00066 {
00067     <a class="code" href="class_chameleon_editor.html#r0">m_mainFrame</a> = mframe;
00068     <a class="code" href="class_chameleon_editor.html#r1">m_parentNotebook</a> = (<a class="code" href="class_chameleon_notebook.html">ChameleonNotebook</a>*)parent;
00069     m_options = options;
00070     m_project = project;
00071     m_project-&gt;<a class="code" href="class_project_info.html#a6">AddEditor</a>(<span class="keyword">this</span>);
00072 
00073     <a class="code" href="class_chameleon_editor.html#r10">m_bLoadingFile</a> = <span class="keyword">false</span>;
00074     <a class="code" href="class_chameleon_editor.html#r11">m_bLastSavedRemotely</a> = <span class="keyword">true</span>;
00075     <a class="code" href="class_chameleon_editor.html#r12">m_bHasBeenCompiled</a> = <span class="keyword">false</span>;
00076 
00077     <a class="code" href="class_chameleon_editor.html#r4">m_fileNameAndPath</a>.Assign(wxEmptyString);
00078 
00079     this-&gt;SetTabWidth(4);
00080 
00081     this-&gt;SetMarginWidth(0, 40);
00082 
00083     this-&gt;SetMarginType(0, wxSTC_MARGIN_NUMBER);
00084 
00085     this-&gt;SetMarginWidth(1, 16);
00086     this-&gt;SetMarginType(1, wxSTC_MARGIN_SYMBOL);
00087 
00088     wxFont font(10, wxMODERN, wxNORMAL, wxNORMAL);
00089 
00090     this-&gt;StyleSetFont(wxSTC_STYLE_DEFAULT, font);
00091 
00092     this-&gt;StyleClearAll();
00093 
00094     <span class="comment">// Editor style setup</span>
00095 
00096     <span class="comment">// whitespace</span>
00097     <span class="comment">//this-&gt;StyleSetForeground(0, wxColour(0x80, 0x80, 0x80));</span>
00098 
00099     <span class="comment">// comment</span>
00100     this-&gt;StyleSetForeground(1, wxColour(0x00, 0x7f, 0x00));
00101 
00102     <span class="comment">// line comment</span>
00103     this-&gt;StyleSetForeground(2, wxColour(0x00, 0x7f, 0x00));
00104 
00105     <span class="comment">// numbers</span>
00106     this-&gt;StyleSetForeground(4, wxColour(<span class="stringliteral">"Red"</span>));
00107 
00108     <span class="comment">// keywords</span>
00109     this-&gt;StyleSetForeground(5, wxColour(<span class="stringliteral">"Blue"</span>));
00110 
00111     this-&gt;StyleSetBold(5, TRUE);
00112 
00113     <span class="comment">// double-quoted strings</span>
00114     this-&gt;StyleSetForeground(6, wxColour(0x00, 0x80, 0x80));
00115 
00116     <span class="comment">// single-quoted strings</span>
00117     this-&gt;StyleSetForeground(7, wxColour(0x00, 0x80, 0x80));
00118 
00119     <span class="comment">// preprocessor</span>
00120     this-&gt;StyleSetForeground(9, wxColour(<span class="stringliteral">"Purple"</span>));
00121 
00122     <span class="comment">// operators</span>
00123     this-&gt;StyleSetForeground(10, wxColour(0x00, 0x00, 0x00));
00124 
00125     this-&gt;StyleSetForeground(11, wxColour(0x00, 0x00, 0x00));
00126 
00127     this-&gt;StyleSetBold(10, TRUE);
00128 
00129     this-&gt;SetSelBackground(<span class="keyword">true</span>, wxColour(49, 106, 197));
00130     this-&gt;SetSelForeground(<span class="keyword">true</span>, wxColour(<span class="stringliteral">"white"</span>));
00131 
00132     this-&gt;EmptyUndoBuffer();
00133 
00134     <a class="code" href="class_chameleon_editor.html#a12">UpdateSyntaxHighlighting</a>();
00135 
00136     this-&gt;MarkerDefine(<a class="code" href="datastructures_8h.html#a148a4">MARKER_BREAKPOINT</a>, wxSTC_MARK_CIRCLE);
00137     this-&gt;MarkerSetBackground(<a class="code" href="datastructures_8h.html#a148a4">MARKER_BREAKPOINT</a>, wxColour(<span class="stringliteral">"red"</span>));
00138 
00139     <span class="comment">//this-&gt;MarkerDefine(1, wxSTC_MARK_CIRCLE);</span>
00140     <span class="comment">//this-&gt;MarkerSetForeground(1, wxColour("red"));</span>
00141 
00142     this-&gt;MarkerDefine(<a class="code" href="datastructures_8h.html#a148a5">MARKER_FOCUSEDLINE</a>, wxSTC_MARK_SHORTARROW);
00143     this-&gt;MarkerSetBackground(<a class="code" href="datastructures_8h.html#a148a5">MARKER_FOCUSEDLINE</a>, wxColour(<span class="stringliteral">"yellow"</span>));
00144 
00145     
00146     <span class="comment">/*</span>
00147 <span class="comment">    for(int i = 0; i &lt;= wxSTC_MARK_PLUS; i++)</span>
00148 <span class="comment">    {</span>
00149 <span class="comment">        this-&gt;MarkerDefine(i, i);</span>
00150 <span class="comment">        this-&gt;MarkerAdd(i, i);</span>
00151 <span class="comment">    }</span>
00152 <span class="comment">    */</span>
00153 
00154     this-&gt;UsePopUp(<span class="keyword">false</span>);
00155     
00156     <a class="code" href="class_chameleon_editor.html#r13">m_popupMenu</a>.Append(<a class="code" href="datastructures_8h.html#a149a44">ID_CUT</a>, <span class="stringliteral">"Cut"</span>);
00157     <a class="code" href="class_chameleon_editor.html#r13">m_popupMenu</a>.Append(<a class="code" href="datastructures_8h.html#a149a43">ID_COPY</a>, <span class="stringliteral">"Copy"</span>);
00158     <a class="code" href="class_chameleon_editor.html#r13">m_popupMenu</a>.Append(<a class="code" href="datastructures_8h.html#a149a45">ID_PASTE</a>, <span class="stringliteral">"Paste"</span>);
00159     <a class="code" href="class_chameleon_editor.html#r13">m_popupMenu</a>.AppendSeparator();
00160 
00161     <a class="code" href="class_chameleon_editor.html#r13">m_popupMenu</a>.Append(<a class="code" href="datastructures_8h.html#a149a80">ID_DEBUG_ADD_BREAKPOINT</a>, <span class="stringliteral">"Add a breakpoint"</span>);
00162     <a class="code" href="class_chameleon_editor.html#r13">m_popupMenu</a>.Append(<a class="code" href="datastructures_8h.html#a149a81">ID_DEBUG_REMOVE_BREAKPOINT</a>, <span class="stringliteral">"Remove this breakpoint"</span>);
00163     <a class="code" href="class_chameleon_editor.html#r13">m_popupMenu</a>.Append(<a class="code" href="datastructures_8h.html#a149a82">ID_DEBUG_CLEAR_ALL_BREAKPOINTS</a>, <span class="stringliteral">"Clear all breakpoints"</span>);
00164 
00165     <a class="code" href="class_chameleon_editor.html#r13">m_popupMenu</a>.Append(<a class="code" href="datastructures_8h.html#a149a83">ID_DEBUG_RUNTOCURSOR</a>, <span class="stringliteral">"Run to cursor"</span>);
00166 
00167     <span class="keywordtype">int</span> modmask =   wxSTC_MOD_INSERTTEXT 
00168                     | wxSTC_MOD_DELETETEXT
00169                     <span class="comment">//| wxSTC_MOD_CHANGESTYLE</span>
00170                     | wxSTC_PERFORMED_UNDO 
00171                     | wxSTC_PERFORMED_REDO;
00172 
00173     this-&gt;SetModEventMask(modmask);
00174 
00175 }
00176 
<a name="l00185"></a><a class="code" href="class_chameleon_editor.html#a1">00185</a> <a class="code" href="class_chameleon_editor.html#a1">ChameleonEditor::~ChameleonEditor</a>() 
00186 {
00187     <span class="keywordflow">if</span>(m_project-&gt;<a class="code" href="class_project_info.html#a14">IsSingleFile</a>())
00188     {
00189         <span class="keyword">delete</span> m_project;
00190     }
00191     <span class="keywordflow">else</span>
00192     {
00193         m_project-&gt;<a class="code" href="class_project_info.html#a7">RemoveEditor</a>(<span class="keyword">this</span>);
00194     }
00195 }
00196 
00197 
00198 
<a name="l00207"></a><a class="code" href="class_chameleon_editor.html#a5">00207</a> <span class="keywordtype">bool</span> <a class="code" href="class_chameleon_editor.html#a5">ChameleonEditor::SaveFileLocal</a>()
00208 {
00209     <span class="keywordflow">return</span> <a class="code" href="class_chameleon_editor.html#a4">SaveFile</a>(<a class="code" href="class_chameleon_editor.html#r4">m_fileNameAndPath</a>.GetFullPath());
00210 }
00211 
<a name="l00222"></a><a class="code" href="class_chameleon_editor.html#a4">00222</a> <span class="keywordtype">bool</span> <a class="code" href="class_chameleon_editor.html#a4">ChameleonEditor::SaveFile</a>( <span class="keyword">const</span> wxString &amp; filename )
00223 {
00224 
00225     <span class="comment">// return if no change</span>
00226     <span class="keywordflow">if</span>(!<a class="code" href="class_chameleon_editor.html#a6">Modified</a>() &amp;&amp; filename.IsEmpty()) { <span class="keywordflow">return</span> <span class="keyword">true</span>; }
00227 
00228     wxFileName fn(filename);
00229 
00230     <span class="comment">// save edit in file and clear undo</span>
00231     <span class="keywordflow">if</span>(!filename.IsEmpty()) 
00232     { 
00233         <a class="code" href="class_chameleon_editor.html#r6">m_simpleFileName</a> = fn.GetFullName(); 
00234     }
00235 
00236     wxFile file (filename, wxFile::write);
00237 
00238     <span class="keywordflow">if</span>(!file.IsOpened()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00239 
00240     wxString buf = GetText();
00241 
00242     <span class="keywordtype">bool</span> okay = file.Write(buf);
00243 
00244     file.Close();
00245 
00246     <span class="keywordflow">if</span>(!okay) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00247 
00248     EmptyUndoBuffer();
00249     SetSavePoint();
00250 
00251     <a class="code" href="class_chameleon_editor.html#r7">m_filetime</a> = fn.GetModificationTime();
00252 
00253     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00254 }
00255 
<a name="l00268"></a><a class="code" href="class_chameleon_editor.html#a3">00268</a> <span class="keywordtype">bool</span> <a class="code" href="class_chameleon_editor.html#a3">ChameleonEditor::LoadFileText</a>(wxString fileContents)
00269 {
00270     <span class="keywordflow">if</span>(fileContents.Length() &gt; 0)
00271     {
00272         <a class="code" href="class_chameleon_editor.html#r10">m_bLoadingFile</a> = <span class="keyword">true</span>;
00273         ClearAll();
00274         InsertText(0, fileContents);
00275     }
00276 
00277     EmptyUndoBuffer();
00278 
00279     <span class="comment">// determine and set EOL mode</span>
00280     <span class="keywordtype">int</span> eolMode = -1;
00281 
00282     <span class="keywordtype">bool</span> eolMix = <span class="keyword">false</span>;
00283 
00284     wxString eolName;
00285 
00286     <span class="keywordflow">if</span>( fileContents.Contains(<span class="stringliteral">"\r\n"</span>) )
00287     {
00288         eolMode = wxSTC_EOL_CRLF;
00289 
00290         eolName = _(<span class="stringliteral">"CR+LF (Windows)"</span>);
00291     }
00292     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fileContents.Contains(<span class="stringliteral">"\r"</span>) )
00293     {
00294         <span class="keywordflow">if</span>(eolMode != -1) { eolMix = <span class="keyword">true</span>; }
00295         <span class="keywordflow">else</span>
00296         {
00297             eolMode = wxSTC_EOL_CR;
00298 
00299             eolName = _(<span class="stringliteral">"CR (Macintosh)"</span>);
00300         }
00301     }
00302     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fileContents.Contains(<span class="stringliteral">"\n"</span>) )
00303     {
00304         <span class="keywordflow">if</span>(eolMode != -1) { eolMix = <span class="keyword">true</span>; }
00305         <span class="keywordflow">else</span>
00306         {
00307             eolMode = wxSTC_EOL_LF;
00308 
00309             eolName = _(<span class="stringliteral">"LF (Unix)"</span>);
00310         }
00311     }
00312 
00313     <span class="keywordflow">if</span>( eolMode != -1 )
00314     {
00315         <span class="keywordflow">if</span>( eolMix &amp;&amp; wxMessageBox(_(<span class="stringliteral">"Convert all line endings to "</span>)
00316             + eolName + _(<span class="stringliteral">"?"</span>), _(<span class="stringliteral">"Line endings"</span>), wxYES_NO | wxICON_QUESTION)
00317             == wxYES )
00318         {
00319             ConvertEOLs(eolMode);
00320 
00321             <span class="comment">// set staus bar text</span>
00322             <span class="comment">// g_statustext-&gt;Clear();</span>
00323             <span class="comment">//g_statustext-&gt;Append(_("Converted line endings to "));</span>
00324             <span class="comment">//g_statustext-&gt;Append(eolName);</span>
00325         }
00326 
00327         SetEOLMode(eolMode);
00328     }
00329 
00330     <a class="code" href="class_chameleon_editor.html#r10">m_bLoadingFile</a> = <span class="keyword">false</span>;
00331 
00332     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00333 }
00334 
<a name="l00343"></a><a class="code" href="class_chameleon_editor.html#a6">00343</a> <span class="keywordtype">bool</span> <a class="code" href="class_chameleon_editor.html#a6">ChameleonEditor::Modified</a> () 
00344 {
00345     <span class="comment">// return modified state</span>
00346     <span class="keywordtype">bool</span> modified = GetModify();
00347     <span class="keywordtype">bool</span> readonly = !GetReadOnly();
00348     <span class="keywordtype">bool</span> canundo = CanUndo();
00349     
00350     
00351 
00352     <span class="keywordtype">bool</span> isModified = modified &amp;&amp; readonly &amp;&amp; canundo;
00353     <span class="keywordflow">return</span> isModified; 
00354 }
00355 
<a name="l00366"></a><a class="code" href="class_chameleon_editor.html#a10">00366</a> <span class="keywordtype">void</span> <a class="code" href="class_chameleon_editor.html#a10">ChameleonEditor::OnChar</a>( wxStyledTextEvent &amp;event )
00367 {
00368 
00369     <span class="keyword">const</span> wxChar chr = event.GetKey();
00370     <span class="keyword">const</span> <span class="keywordtype">int</span> currentLine = GetCurrentLine();
00371     <span class="keyword">const</span> <span class="keywordtype">int</span> tabWidth = GetTabWidth();
00372     <span class="keyword">const</span> <span class="keywordtype">int</span> eolMode = GetEOLMode();
00373 
00374     <span class="keywordflow">if</span>( chr == WXK_TAB )
00375     {
00376         event.Skip(<span class="keyword">true</span>);
00377 
00378         <span class="keywordtype">int</span> startLine = LineFromPosition(GetSelectionStart());
00379 
00380         <span class="keywordtype">int</span> endline = LineFromPosition(GetSelectionEnd());
00381 
00382         <span class="keywordtype">int</span> newStartPos = PositionFromLine(startLine);
00383 
00384         <span class="keywordtype">int</span> newEndPos = PositionFromLine(endline) + LineLength(endline);
00385 
00386         this-&gt;SetSelection(newStartPos, newEndPos);
00387 
00388         <span class="keywordtype">bool</span> doIndent = event.GetShift();
00389 
00390         <span class="keywordtype">int</span> indentWidth = this-&gt;GetIndent();
00391 
00392         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = startLine; i &lt;= endline; i++ )
00393         {
00394             <span class="keywordtype">int</span> lineIndent = this-&gt;GetLineIndentation(i);
00395 
00396             <span class="keywordflow">if</span>(doIndent)
00397                 { this-&gt;SetLineIndentation(i, lineIndent + indentWidth); }
00398             <span class="keywordflow">else</span>
00399             {
00400                 this-&gt;SetLineIndentation(i, lineIndent - indentWidth);
00401             }
00402         }
00403     }
00404 
00405     <span class="comment">//if (((eolMode == CRLF || eolMode == LF) &amp;&amp; chr == '\n')</span>
00406     <span class="comment">//  || (eolMode == CR &amp;&amp; chr == '\r'))</span>
00407     <span class="keywordflow">if</span>(chr == <span class="charliteral">'\n'</span> &amp;&amp; m_options-&gt;<a class="code" href="class_options.html#a21">GetPerms</a>()-&gt;<a class="code" href="class_permission.html#a2">isEnabled</a>(<a class="code" href="datastructures_8h.html#a150a92">PERM_AUTOINDENT</a>))
00408     {
00409         <span class="keywordtype">int</span> previousLineInd = 0;
00410 
00411         <span class="keywordflow">if</span> (currentLine &gt; 0)
00412         {
00413             previousLineInd = GetLineIndentation(currentLine - 1);
00414         }
00415 
00416         <span class="keywordflow">if</span> (previousLineInd == 0)
00417         {
00418             <span class="keywordflow">return</span>;
00419         }
00420 
00421         SetLineIndentation(currentLine, previousLineInd);
00422 
00423         <span class="comment">// If tabs are being used then change previousLineInd to tab sizes</span>
00424         <span class="keywordflow">if</span> (GetUseTabs())
00425         {
00426             previousLineInd /= GetTabWidth();
00427         }
00428 
00429         GotoPos(PositionFromLine(currentLine) + previousLineInd);
00430     }
00431 
00432     <span class="keywordflow">return</span>;
00433 }
00434 
<a name="l00443"></a><a class="code" href="class_chameleon_editor.html#a8">00443</a> <span class="keywordtype">bool</span> <a class="code" href="class_chameleon_editor.html#a8">ChameleonEditor::HasBeenSaved</a>()
00444 {
00445     <span class="keywordtype">bool</span> result = <a class="code" href="class_chameleon_editor.html#r4">m_fileNameAndPath</a>.GetFullPath() != wxEmptyString;
00446     <span class="keywordflow">return</span> result;
00447 }
00448 
00449 <span class="comment">/*</span>
00450 <span class="comment">void ChameleonEditor::SetRemoteFileNameAndPath(wxString path, wxString name)</span>
00451 <span class="comment">{</span>
00452 <span class="comment">    m_remoteFileName.Assign(path, name, wxPATH_UNIX);</span>
00453 <span class="comment">}</span>
00454 <span class="comment"></span>
00455 <span class="comment">void ChameleonEditor::SetLocalFileNameAndPath(wxString path, wxString name)</span>
00456 <span class="comment">{</span>
00457 <span class="comment">    m_localFileName.Assign(path, name, wxPATH_DOS);</span>
00458 <span class="comment">}</span>
00459 <span class="comment">*/</span>
00460 
<a name="l00472"></a><a class="code" href="class_chameleon_editor.html#a12">00472</a> <span class="keywordtype">void</span> <a class="code" href="class_chameleon_editor.html#a12">ChameleonEditor::UpdateSyntaxHighlighting</a>()
00473 {
00474     <span class="keywordflow">if</span>( m_options-&gt;<a class="code" href="class_options.html#a21">GetPerms</a>()-&gt;<a class="code" href="class_permission.html#a2">isEnabled</a>(<a class="code" href="datastructures_8h.html#a150a91">PERM_SYNTAXHIGHLIGHT</a>) )
00475     {
00476         this-&gt;SetLexer(wxSTC_LEX_CPP);
00477 
00478         this-&gt;SetKeyWords(0, <span class="stringliteral">"asm auto bool break case catch char class const "</span>
00479             <span class="stringliteral">"const_cast continue default delete do double "</span>
00480             <span class="stringliteral">"dynamic_cast else enum explicit export extern "</span>
00481             <span class="stringliteral">"false float for friend goto if inline int long "</span>
00482             <span class="stringliteral">"mutable namespace new operator private protected "</span>
00483             <span class="stringliteral">"public register reinterpret_cast return short signed "</span>
00484             <span class="stringliteral">"sizeof static static_cast struct switch template this "</span>
00485             <span class="stringliteral">"throw true try typedef typeid typename union unsigned "</span>
00486             <span class="stringliteral">"using virtual void volatile wchar_t while"</span>);
00487         this-&gt;Colourise(0, -1);
00488     }
00489     <span class="keywordflow">else</span>
00490     {
00491         this-&gt;SetLexer(wxSTC_LEX_NULL);
00492         this-&gt;ClearDocumentStyle();
00493     }
00494 }
00495 
<a name="l00507"></a><a class="code" href="class_chameleon_editor.html#a22">00507</a> <span class="keywordtype">void</span> <a class="code" href="class_chameleon_editor.html#a22">ChameleonEditor::SetFilename</a>(wxFileName filename, <span class="keywordtype">bool</span> fileIsRemote)
00508 {
00509     <a class="code" href="class_chameleon_editor.html#r11">m_bLastSavedRemotely</a> = fileIsRemote;
00510 
00511     <span class="comment">//m_fileNameAndPath.Assign(path, name, fileIsRemote ? wxPATH_UNIX : wxPATH_DOS);</span>
00512 
00513     <span class="keywordflow">if</span>(m_project-&gt;<a class="code" href="class_project_info.html#a14">IsSingleFile</a>())
00514     {
00515         wxString oldFileName = <a class="code" href="class_chameleon_editor.html#r4">m_fileNameAndPath</a>.GetFullPath(<a class="code" href="class_chameleon_editor.html#r11">m_bLastSavedRemotely</a> ? wxPATH_UNIX : wxPATH_DOS);
00516 
00517         <span class="keywordflow">if</span>(m_project-&gt;<a class="code" href="class_project_info.html#a1">FileExistsInProject</a>(oldFileName))
00518         {
00519             <a class="code" href="datastructures_8h.html#a156">FileFilterType</a> oldFilterType;
00520             wxString oldExtension = <a class="code" href="class_chameleon_editor.html#r4">m_fileNameAndPath</a>.GetExt();
00521             <span class="keywordflow">if</span>(oldExtension.StartsWith(<span class="stringliteral">"h"</span>))
00522             {
00523                 oldFilterType = <a class="code" href="datastructures_8h.html#a156a133">FILE_HEADERS</a>;
00524             }
00525             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(oldExtension.StartsWith(<span class="stringliteral">"c"</span>))
00526             {
00527                 oldFilterType = <a class="code" href="datastructures_8h.html#a156a132">FILE_SOURCES</a>;
00528             }
00529 
00530             m_project-&gt;<a class="code" href="class_project_info.html#a3">RemoveFileFromProject</a>(oldFileName, oldFilterType);
00531         }
00532 
00533         wxString newFileName = filename.GetFullPath(fileIsRemote ? wxPATH_UNIX : wxPATH_DOS);
00534         <span class="keywordflow">if</span>(!m_project-&gt;<a class="code" href="class_project_info.html#a1">FileExistsInProject</a>(newFileName))
00535         {
00536             <a class="code" href="datastructures_8h.html#a156">FileFilterType</a> newFilterType;
00537             wxString newExtension = filename.GetExt();
00538             <span class="keywordflow">if</span>(newExtension.StartsWith(<span class="stringliteral">"h"</span>))
00539             {
00540                 newFilterType = <a class="code" href="datastructures_8h.html#a156a133">FILE_HEADERS</a>;
00541             }
00542             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(newExtension.StartsWith(<span class="stringliteral">"c"</span>))
00543             {
00544                 newFilterType = <a class="code" href="datastructures_8h.html#a156a132">FILE_SOURCES</a>;
00545             }
00546             m_project-&gt;<a class="code" href="class_project_info.html#a2">AddFileToProject</a>(newFileName, newFilterType);
00547         }       
00548 
00549         m_project-&gt;<a class="code" href="class_project_info.html#a25">SetRemote</a>(fileIsRemote);
00550     }   
00551 
00552     <a class="code" href="class_chameleon_editor.html#r4">m_fileNameAndPath</a> = filename;
00553 }
00554 
<a name="l00563"></a><a class="code" href="class_chameleon_editor.html#a14">00563</a> wxString <a class="code" href="class_chameleon_editor.html#a14">ChameleonEditor::GetFileNameAndPath</a>()
00564 {
00565     wxString nameAndPath = <a class="code" href="class_chameleon_editor.html#r4">m_fileNameAndPath</a>.GetFullPath(<a class="code" href="class_chameleon_editor.html#r11">m_bLastSavedRemotely</a> ? wxPATH_UNIX : wxPATH_DOS);
00566     <span class="keywordflow">return</span> nameAndPath;
00567 }
00568 
<a name="l00577"></a><a class="code" href="class_chameleon_editor.html#a15">00577</a> wxString <a class="code" href="class_chameleon_editor.html#a15">ChameleonEditor::GetFilenameString</a>()
00578 {
00579     <span class="keywordflow">return</span> <a class="code" href="class_chameleon_editor.html#r4">m_fileNameAndPath</a>.GetFullName();
00580 }
00581 
<a name="l00590"></a><a class="code" href="class_chameleon_editor.html#a16">00590</a> wxFileName <a class="code" href="class_chameleon_editor.html#a16">ChameleonEditor::GetFileName</a>() {
00591     <span class="keywordflow">return</span> <a class="code" href="class_chameleon_editor.html#r4">m_fileNameAndPath</a>;
00592 }
00593 
<a name="l00602"></a><a class="code" href="class_chameleon_editor.html#a18">00602</a> wxString <a class="code" href="class_chameleon_editor.html#a18">ChameleonEditor::GetFilePath</a>()
00603 {
00604     <span class="keywordflow">return</span> <a class="code" href="class_chameleon_editor.html#r4">m_fileNameAndPath</a>.GetPath(<span class="keyword">false</span>, <a class="code" href="class_chameleon_editor.html#r11">m_bLastSavedRemotely</a> ? wxPATH_UNIX : wxPATH_DOS);
00605 }
00606 
<a name="l00615"></a><a class="code" href="class_chameleon_editor.html#a25">00615</a> <span class="keywordtype">void</span> <a class="code" href="class_chameleon_editor.html#a25">ChameleonEditor::ResetEditor</a>()
00616 {
00617     ClearAll();
00618     
00619     <a class="code" href="class_chameleon_editor.html#r4">m_fileNameAndPath</a>.Clear();
00620     <a class="code" href="class_chameleon_editor.html#r8">m_breakpoints</a>.Clear();
00621 
00622     SetReadOnly(<span class="keyword">false</span>);
00623     SetText(wxEmptyString);
00624     SetSavePoint();
00625     EmptyUndoBuffer();
00626     
00627     MarkerDeleteAll(<a class="code" href="datastructures_8h.html#a148a4">MARKER_BREAKPOINT</a>);
00628     MarkerDeleteAll(<a class="code" href="datastructures_8h.html#a148a5">MARKER_FOCUSEDLINE</a>);
00629 
00630     <span class="keywordflow">if</span>(m_project != <a class="code" href="_crc16_8h.html#a0">NULL</a> &amp;&amp; m_project-&gt;<a class="code" href="class_project_info.html#a14">IsSingleFile</a>())
00631     {
00632         <span class="keyword">delete</span> m_project;
00633     }
00634     
00635     m_project = <span class="keyword">new</span> <a class="code" href="class_project_info.html">ProjectInfo</a>();
00636 }
00637 
<a name="l00648"></a><a class="code" href="class_chameleon_editor.html#a11">00648</a> <span class="keywordtype">void</span> <a class="code" href="class_chameleon_editor.html#a11">ChameleonEditor::OnRightClick</a>(wxMouseEvent &amp;event)
00649 {
00650     <a class="code" href="class_chameleon_editor.html#r9">m_lastRightClick</a> = event.GetPosition();
00651     <span class="keywordtype">int</span> charpos = PositionFromPoint(<a class="code" href="class_chameleon_editor.html#r9">m_lastRightClick</a>);
00652     <span class="keywordtype">int</span> linenum = LineFromPosition(charpos);
00653     <span class="keywordtype">int</span> markerLineBitmask = this-&gt;MarkerGet(linenum);
00654 
00655     <span class="keywordtype">bool</span> breakpointOnLine = (markerLineBitmask &amp; (1 &lt;&lt; <a class="code" href="datastructures_8h.html#a148a4">MARKER_BREAKPOINT</a>));
00656 
00657     <span class="keywordtype">bool</span> breakpointsAllowed = <span class="keyword">true</span>;
00658     <span class="keywordtype">bool</span> isDebugging = <a class="code" href="class_chameleon_editor.html#r0">m_mainFrame</a>-&gt;<a class="code" href="class_chameleon_window.html#a6">IsDebugging</a>();
00659     
00660     <span class="keywordflow">if</span>(isDebugging)
00661     {
00662         breakpointsAllowed = <a class="code" href="class_chameleon_editor.html#r0">m_mainFrame</a>-&gt;<a class="code" href="class_chameleon_window.html#a7">IsDebuggerPaused</a>();
00663     }
00664 
00665     <a class="code" href="class_chameleon_editor.html#r13">m_popupMenu</a>.Enable(<a class="code" href="datastructures_8h.html#a149a80">ID_DEBUG_ADD_BREAKPOINT</a>, breakpointsAllowed &amp;&amp; !breakpointOnLine);
00666     <a class="code" href="class_chameleon_editor.html#r13">m_popupMenu</a>.Enable(<a class="code" href="datastructures_8h.html#a149a81">ID_DEBUG_REMOVE_BREAKPOINT</a>, breakpointsAllowed &amp;&amp; breakpointOnLine);
00667     <a class="code" href="class_chameleon_editor.html#r13">m_popupMenu</a>.Enable(<a class="code" href="datastructures_8h.html#a149a83">ID_DEBUG_RUNTOCURSOR</a>, breakpointsAllowed &amp;&amp; isDebugging);
00668 
00669     <span class="comment">// returns a copy of a member variable, which would seem sort of pointless, but</span>
00670     <span class="comment">// GetBreakpoints cleans up any stray marker IDs in the list before returning</span>
00671     <span class="comment">// so we have an accurate count of how many breakpoints there are</span>
00672     wxArrayInt currentBreakpoints = <a class="code" href="class_chameleon_editor.html#a19">GetBreakpoints</a>();
00673     <span class="keywordtype">bool</span> canClearBreakpoints = currentBreakpoints.GetCount() &gt; 0;
00674 
00675     <a class="code" href="class_chameleon_editor.html#r13">m_popupMenu</a>.Enable(<a class="code" href="datastructures_8h.html#a149a82">ID_DEBUG_CLEAR_ALL_BREAKPOINTS</a>, canClearBreakpoints);
00676 
00677     
00678     PopupMenu(&amp;<a class="code" href="class_chameleon_editor.html#r13">m_popupMenu</a>, <a class="code" href="class_chameleon_editor.html#r9">m_lastRightClick</a>);
00679 }
00680 
<a name="l00691"></a><a class="code" href="class_chameleon_editor.html#d0">00691</a> <span class="keywordtype">void</span> <a class="code" href="class_chameleon_editor.html#d0">ChameleonEditor::OnEditorModified</a>(wxStyledTextEvent &amp;event)
00692 {
00693     m_project-&gt;<a class="code" href="class_project_info.html#a27">SetCompiled</a>(<span class="keyword">false</span>);
00694 }
00695 
<a name="l00706"></a><a class="code" href="class_chameleon_editor.html#d1">00706</a> <span class="keywordtype">void</span> <a class="code" href="class_chameleon_editor.html#d1">ChameleonEditor::OnAddBreakpoint</a>(wxCommandEvent &amp;event)
00707 {
00708     <span class="keywordtype">int</span> charpos = PositionFromPoint(<a class="code" href="class_chameleon_editor.html#r9">m_lastRightClick</a>);
00709     <span class="keywordtype">int</span> linenum = LineFromPosition(charpos);
00710 
00711     <span class="keywordtype">int</span> markerNum = this-&gt;MarkerAdd(linenum, <a class="code" href="datastructures_8h.html#a148a4">MARKER_BREAKPOINT</a>);
00712     
00713     <a class="code" href="class_chameleon_editor.html#r8">m_breakpoints</a>.Add(markerNum);
00714     <a class="code" href="class_chameleon_editor.html#d5">CreateBreakpointEvent</a>(linenum, <span class="keyword">true</span>);   
00715 }
00716 
<a name="l00731"></a><a class="code" href="class_chameleon_editor.html#d2">00731</a> <span class="keywordtype">void</span> <a class="code" href="class_chameleon_editor.html#d2">ChameleonEditor::OnRemoveBreakpoint</a>(wxCommandEvent &amp;event)
00732 {
00733     <span class="keywordtype">int</span> charpos = PositionFromPoint(<a class="code" href="class_chameleon_editor.html#r9">m_lastRightClick</a>);
00734     <span class="keywordtype">int</span> linenum = LineFromPosition(charpos);
00735 
00736     <span class="comment">// need to remove the marker handle from the array - use</span>
00737     <span class="comment">// LineFromHandle on debug start and clean up then</span>
00738     this-&gt;MarkerDelete(linenum, <a class="code" href="datastructures_8h.html#a148a4">MARKER_BREAKPOINT</a>);
00739     <a class="code" href="class_chameleon_editor.html#d5">CreateBreakpointEvent</a>(linenum, <span class="keyword">false</span>);
00740 }
00741 
<a name="l00752"></a><a class="code" href="class_chameleon_editor.html#d3">00752</a> <span class="keywordtype">void</span> <a class="code" href="class_chameleon_editor.html#d3">ChameleonEditor::OnClearBreakpoints</a>(wxCommandEvent &amp;event)
00753 {
00754     <span class="comment">// m_breakpoints should have been cleared of any orphaned marker</span>
00755     <span class="comment">// handles during the right-click that led us here</span>
00756     <span class="keywordtype">int</span> numBreakpoints = <a class="code" href="class_chameleon_editor.html#r8">m_breakpoints</a>.GetCount();
00757 
00758     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; numBreakpoints; i++)
00759     {
00760         <span class="keywordtype">int</span> markerHandle = <a class="code" href="class_chameleon_editor.html#r8">m_breakpoints</a>[i];
00761         <span class="keywordtype">int</span> linenum = this-&gt;MarkerLineFromHandle(markerHandle);
00762         this-&gt;MarkerDeleteHandle(markerHandle);
00763         <a class="code" href="class_chameleon_editor.html#d5">CreateBreakpointEvent</a>(linenum, <span class="keyword">false</span>);
00764     }
00765 }
00766 
<a name="l00775"></a><a class="code" href="class_chameleon_editor.html#a19">00775</a> wxArrayInt <a class="code" href="class_chameleon_editor.html#a19">ChameleonEditor::GetBreakpoints</a>()
00776 {
00777     wxArrayInt linenumbers;
00778     wxArrayInt invalidBreakpoints;
00779 
00780     <span class="keywordtype">int</span> numStoredBreakpoints = <a class="code" href="class_chameleon_editor.html#r8">m_breakpoints</a>.GetCount();
00781     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; numStoredBreakpoints; i++)
00782     {
00783         <span class="keywordtype">int</span> markerHandle = <a class="code" href="class_chameleon_editor.html#r8">m_breakpoints</a>[i];
00784 
00785         <span class="keywordtype">int</span> linenum = this-&gt;MarkerLineFromHandle(markerHandle);
00786 
00787         <span class="keywordflow">if</span>(linenum != -1)
00788         {
00789             linenumbers.Add(linenum + 1);
00790         }
00791         <span class="keywordflow">else</span>
00792         {
00793             invalidBreakpoints.Add(markerHandle);
00794         }
00795     }
00796 
00797     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; (<span class="keywordtype">int</span>)invalidBreakpoints.GetCount(); i++)
00798     {
00799         <a class="code" href="class_chameleon_editor.html#r8">m_breakpoints</a>.Remove(invalidBreakpoints[i]);
00800     }
00801 
00802     linenumbers.Sort((CMPFUNC_wxArraywxArrayInt)<a class="code" href="editor_8cpp.html#a1">CompareInts</a>);
00803     <span class="keywordflow">return</span> linenumbers;
00804 }
00805 
<a name="l00814"></a><a class="code" href="class_chameleon_editor.html#a7">00814</a> <span class="keywordtype">bool</span> <a class="code" href="class_chameleon_editor.html#a7">ChameleonEditor::HasBeenCompiled</a>()
00815 {
00816     <span class="keywordflow">return</span> m_project-&gt;<a class="code" href="class_project_info.html#a15">IsCompiled</a>();
00817 }
00818 
<a name="l00827"></a><a class="code" href="class_chameleon_editor.html#a9">00827</a> <span class="keywordtype">void</span> <a class="code" href="class_chameleon_editor.html#a9">ChameleonEditor::SetCompiled</a>()
00828 {
00829     m_project-&gt;<a class="code" href="class_project_info.html#a27">SetCompiled</a>(<span class="keyword">true</span>);
00830 }
00831 
<a name="l00843"></a><a class="code" href="class_chameleon_editor.html#a13">00843</a> <span class="keywordtype">void</span> <a class="code" href="class_chameleon_editor.html#a13">ChameleonEditor::FocusOnLine</a>(<span class="keywordtype">int</span> linenumber, <span class="keywordtype">bool</span> showMarker)
00844 {
00845     GotoLine(linenumber);
00846     <span class="keywordflow">if</span>(showMarker)
00847     {
00848         MarkerDeleteAll(<a class="code" href="datastructures_8h.html#a148a5">MARKER_FOCUSEDLINE</a>);
00849         MarkerAdd(linenumber, <a class="code" href="datastructures_8h.html#a148a5">MARKER_FOCUSEDLINE</a>);
00850     }
00851 }
<a name="l00863"></a><a class="code" href="class_chameleon_editor.html#d5">00863</a> <span class="keywordtype">void</span> <a class="code" href="class_chameleon_editor.html#d5">ChameleonEditor::CreateBreakpointEvent</a>(<span class="keywordtype">int</span> linenumber, <span class="keywordtype">bool</span> addBreakpoint)
00864 {
00865     <a class="code" href="classwx_debug_event.html">wxDebugEvent</a> dbg;
00866     wxString filename = <a class="code" href="class_chameleon_editor.html#r4">m_fileNameAndPath</a>.GetFullPath(wxPATH_UNIX);
00867     <span class="comment">//wxArrayString sources;</span>
00868     <span class="comment">//sources.Add(filename);</span>
00869     dbg.<a class="code" href="classwx_debug_event.html#a6">SetSourceFilename</a>(filename);
00870     <span class="comment">// adjust for the zero-based index</span>
00871     dbg.<a class="code" href="classwx_debug_event.html#a2">SetLineNumber</a>(linenumber + 1);
00872     <span class="keywordtype">int</span> type = addBreakpoint ? <a class="code" href="datastructures_8h.html#a149a80">ID_DEBUG_ADD_BREAKPOINT</a> : <a class="code" href="datastructures_8h.html#a149a81">ID_DEBUG_REMOVE_BREAKPOINT</a>;
00873     dbg.SetId(type);
00874     dbg.SetId(type);
00875     dbg.<a class="code" href="classwx_debug_event.html#a11">SetProject</a>(m_project);
00876     <a class="code" href="class_chameleon_editor.html#r0">m_mainFrame</a>-&gt;AddPendingEvent(dbg);
00877 }
00878 
00879 
<a name="l00890"></a><a class="code" href="class_chameleon_editor.html#a24">00890</a> <span class="keywordtype">void</span> <a class="code" href="class_chameleon_editor.html#a24">ChameleonEditor::SetProject</a>(<a class="code" href="class_project_info.html">ProjectInfo</a>* project)
00891 {
00892     <span class="keywordflow">if</span>(m_project != <a class="code" href="_crc16_8h.html#a0">NULL</a> &amp;&amp; m_project-&gt;<a class="code" href="class_project_info.html#a14">IsSingleFile</a>())
00893     {
00894         <span class="keyword">delete</span> m_project;
00895     }
00896 
00897     m_project = project;
00898     m_project-&gt;<a class="code" href="class_project_info.html#a6">AddEditor</a>(<span class="keyword">this</span>);
00899 }
00900 
<a name="l00911"></a><a class="code" href="class_chameleon_editor.html#d4">00911</a> <span class="keywordtype">void</span> <a class="code" href="class_chameleon_editor.html#d4">ChameleonEditor::OnRunToCursor</a>(wxCommandEvent &amp;event)
00912 {
00913     <span class="keywordtype">int</span> charpos = PositionFromPoint(<a class="code" href="class_chameleon_editor.html#r9">m_lastRightClick</a>);
00914     <span class="keywordtype">int</span> linenum = LineFromPosition(charpos);
00915     <span class="comment">// adjust for Scintilla's internal zero-based line numbering</span>
00916     linenum++;
00917 
00918     <a class="code" href="classwx_debug_event.html">wxDebugEvent</a> debugEvent;
00919     debugEvent.SetId(<a class="code" href="datastructures_8h.html#a149a83">ID_DEBUG_RUNTOCURSOR</a>); 
00920     debugEvent.<a class="code" href="classwx_debug_event.html#a6">SetSourceFilename</a>(<a class="code" href="class_chameleon_editor.html#a15">GetFilenameString</a>());
00921     debugEvent.<a class="code" href="classwx_debug_event.html#a2">SetLineNumber</a>(linenum);
00922     <a class="code" href="class_chameleon_editor.html#r0">m_mainFrame</a>-&gt;AddPendingEvent(debugEvent);
00923 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Apr 28 16:45:38 2004 for Chameleon by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
