<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Chameleon: actions.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>actions.cpp</h1><a href="actions_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// Copyright Timothy Miller, 1999</span>
00002 
00003 <span class="preprocessor">#include "<a class="code" href="gterm_8hpp.html">gterm.hpp</a>"</span>
00004 <span class="preprocessor">#include "../common/debug.h"</span>
00005 
00006 <span class="preprocessor">#ifdef _DEBUG</span>
00007 <span class="preprocessor"></span>
00008 <span class="preprocessor">#define new DEBUG_NEW</span>
00009 <span class="preprocessor"></span>
00010 <span class="preprocessor">#endif</span>
00011 <span class="preprocessor"></span>
00012 <span class="comment">// For efficiency, this grabs all printing characters from buffer, up to</span>
00013 <span class="comment">// the end of the line or end of buffer</span>
00014 
<a name="l00023"></a><a class="code" href="class_g_term.html#d14">00023</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d14">GTerm::normal_input</a>()
00024 {
00025     <span class="keywordtype">int</span> n, n_taken, i, c, y;
00026 
00027 <span class="preprocessor">#if 0</span>
00028 <span class="preprocessor"></span>
00029     <span class="keywordtype">char</span> str[100];
00030 
00031 <span class="preprocessor">#endif</span>
00032 <span class="preprocessor"></span>
00033     <span class="keywordflow">if</span> (* <a class="code" href="class_g_term.html#r38">input_data</a>&lt;32)
00034         <span class="keywordflow">return</span>;
00035 
00036     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r13">cursor_x</a>&gt;=<a class="code" href="class_g_term.html#r0">width</a>)
00037     {
00038         <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r20">mode_flags</a> &amp; <a class="code" href="class_g_term.html#w79w4">NOEOLWRAP</a>)
00039         {
00040             <a class="code" href="class_g_term.html#r13">cursor_x</a> = <a class="code" href="class_g_term.html#r0">width</a> - 1;
00041         }
00042         <span class="keywordflow">else</span>
00043         {
00044             <a class="code" href="class_g_term.html#d33">next_line</a>();
00045         }
00046     }
00047 
00048     n = 0;
00049 
00050     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r20">mode_flags</a> &amp; <a class="code" href="class_g_term.html#w79w4">NOEOLWRAP</a>)
00051     {
00052         <span class="keywordflow">while</span> (<a class="code" href="class_g_term.html#r38">input_data</a>[n]&gt;31 &amp;&amp; n&lt;<a class="code" href="class_g_term.html#r39">data_len</a>)
00053             n++;
00054 
00055         n_taken = n;
00056 
00057         <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r13">cursor_x</a> + n&gt;=<a class="code" href="class_g_term.html#r0">width</a>)
00058             n = <a class="code" href="class_g_term.html#r0">width</a> - <a class="code" href="class_g_term.html#r13">cursor_x</a>;
00059     }
00060     <span class="keywordflow">else</span>
00061     {
00062         <span class="keywordflow">while</span> (<a class="code" href="class_g_term.html#r38">input_data</a>[n]&gt;31 &amp;&amp; n&lt;<a class="code" href="class_g_term.html#r39">data_len</a> &amp;&amp; <a class="code" href="class_g_term.html#r13">cursor_x</a> + n&lt;<a class="code" href="class_g_term.html#r0">width</a>)
00063             n++;
00064 
00065         n_taken = n;
00066     }
00067 
00068 <span class="preprocessor">#if 0</span>
00069 <span class="preprocessor"></span>
00070     memcpy(str, <a class="code" href="class_g_term.html#r38">input_data</a>, n);
00071     str[n] = 0;
00072     <span class="comment">//printf("Processing %d characters (%d): %s\n", n, str[0], str);</span>
00073 
00074 <span class="preprocessor">#endif</span>
00075 <span class="preprocessor"></span>
00076     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r20">mode_flags</a> &amp; <a class="code" href="class_g_term.html#w79w8">INSERT</a>)
00077     {
00078         <a class="code" href="class_g_term.html#d11">changed_line</a>(<a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r0">width</a> - 1);
00079     }
00080     <span class="keywordflow">else</span>
00081     {
00082         <a class="code" href="class_g_term.html#d11">changed_line</a>(<a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r13">cursor_x</a> + n - 1);
00083     }
00084 
00085     <span class="comment">// IMPORTANT Here's where the text pointer gets assigned.</span>
00086     y = <a class="code" href="class_g_term.html#r7">linenumbers</a>[<a class="code" href="class_g_term.html#r14">cursor_y</a>] * <a class="code" href="gterm_8hpp.html#a0">MAXWIDTH</a>;
00087 
00088     <span class="keywordtype">int</span> altY = <a class="code" href="class_g_term.html#r12">m_nextLineCounter</a> * <a class="code" href="gterm_8hpp.html#a0">MAXWIDTH</a>;
00089 
00090     <span class="comment">// MPE: moves the text after the cursor to the right N spaces (inserting)</span>
00091     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r20">mode_flags</a> &amp; <a class="code" href="class_g_term.html#w79w8">INSERT</a>)
00092         <span class="keywordflow">for</span> (i = <a class="code" href="class_g_term.html#r0">width</a> - 1; i&gt;=<a class="code" href="class_g_term.html#r13">cursor_x</a> + n; i--)
00093         {
00094             <span class="comment">//text[y + i] = text[y + i - n];</span>
00095 
00096             <span class="keywordtype">char</span> c = <a class="code" href="class_g_term.html#r5">tm</a>.<a class="code" href="class_text_manager.html#a8">GetCharAdjusted</a>(<a class="code" href="class_g_term.html#r14">cursor_y</a>, i - n);
00097             <a class="code" href="class_g_term.html#r5">tm</a>.<a class="code" href="class_text_manager.html#a14">SetCharAdjusted</a>(<a class="code" href="class_g_term.html#r14">cursor_y</a>, i, c);
00098 
00099             <span class="comment">//color[y + i] = color[y + i - n];</span>
00100 
00101             <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> tempcolor = <a class="code" href="class_g_term.html#r5">tm</a>.<a class="code" href="class_text_manager.html#a10">GetColorAdjusted</a>(<a class="code" href="class_g_term.html#r14">cursor_y</a>, i - n);
00102             <a class="code" href="class_g_term.html#r5">tm</a>.<a class="code" href="class_text_manager.html#a19">SetColorAdjusted</a>(<a class="code" href="class_g_term.html#r14">cursor_y</a>, i, tempcolor);
00103         }
00104 
00105     c = <a class="code" href="class_g_term.html#d13">calc_color</a>(<a class="code" href="class_g_term.html#r18">fg_color</a>, <a class="code" href="class_g_term.html#r19">bg_color</a>, <a class="code" href="class_g_term.html#r20">mode_flags</a>);
00106 
00107     <span class="comment">// MPE: inserts the new received text, overwriting what was there already</span>
00108     <span class="keywordflow">for</span> (i = 0; i&lt;n; i++)
00109     {
00110         <span class="comment">//text[y + cursor_x] = input_data[i];</span>
00111         <a class="code" href="class_g_term.html#r5">tm</a>.<a class="code" href="class_text_manager.html#a14">SetCharAdjusted</a>(<a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r38">input_data</a>[i]);
00112 
00113         <span class="comment">//color[y + cursor_x] = c;</span>
00114         <a class="code" href="class_g_term.html#r5">tm</a>.<a class="code" href="class_text_manager.html#a19">SetColorAdjusted</a>(<a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r13">cursor_x</a>, c);
00115         <a class="code" href="class_g_term.html#r13">cursor_x</a>++;
00116     }
00117 
00118     <a class="code" href="class_g_term.html#r38">input_data</a> += n_taken - 1;
00119     <a class="code" href="class_g_term.html#r39">data_len</a> -= n_taken - 1;
00120 }
00121 
<a name="l00122"></a><a class="code" href="class_g_term.html#d20">00122</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d20">GTerm::cr</a>() { <a class="code" href="class_g_term.html#d12">move_cursor</a>(0, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00123 }
00124 
<a name="l00125"></a><a class="code" href="class_g_term.html#d21">00125</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d21">GTerm::lf</a>()
00126 {
00127     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r14">cursor_y</a>&lt;<a class="code" href="class_g_term.html#r3">scroll_bot</a>)
00128     {
00129         <a class="code" href="class_g_term.html#d12">move_cursor</a>(<a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r14">cursor_y</a> + 1);
00130     }
00131     <span class="keywordflow">else</span>
00132     {
00133         <a class="code" href="class_g_term.html#d8">scroll_region</a>(<a class="code" href="class_g_term.html#r2">scroll_top</a>, <a class="code" href="class_g_term.html#r3">scroll_bot</a>, 1);
00134 
00135         
00136     }
00137 
00138     <a class="code" href="class_g_term.html#r5">tm</a>.<a class="code" href="class_text_manager.html#a11">CursorDown</a>();
00139 }
00140 
<a name="l00141"></a><a class="code" href="class_g_term.html#d22">00141</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d22">GTerm::ff</a>()
00142 {
00143     <a class="code" href="class_g_term.html#d10">clear_area</a>(0, <a class="code" href="class_g_term.html#r2">scroll_top</a>, <a class="code" href="class_g_term.html#r0">width</a> - 1, <a class="code" href="class_g_term.html#r3">scroll_bot</a>);
00144 
00145     <a class="code" href="class_g_term.html#d12">move_cursor</a>(0, <a class="code" href="class_g_term.html#r2">scroll_top</a>);
00146 }
00147 
<a name="l00148"></a><a class="code" href="class_g_term.html#d24">00148</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d24">GTerm::tab</a>()
00149 {
00150     <span class="keywordtype">int</span> i, x = 0;
00151 
00152     <span class="keywordflow">for</span> (i = <a class="code" href="class_g_term.html#r13">cursor_x</a> + 1; i&lt;<a class="code" href="class_g_term.html#r0">width</a> &amp;&amp; !x; i++)<span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r21">tab_stops</a>[i])
00153         x = i;
00154 
00155     <span class="keywordflow">if</span> (!x)
00156         x = (<a class="code" href="class_g_term.html#r13">cursor_x</a> + 8) &amp; -8;
00157 
00158     <span class="keywordflow">if</span> (x&lt;<a class="code" href="class_g_term.html#r0">width</a>)
00159     {
00160         <a class="code" href="class_g_term.html#d12">move_cursor</a>(x, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00161     }
00162     <span class="keywordflow">else</span>
00163     {
00164         <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r20">mode_flags</a> &amp; <a class="code" href="class_g_term.html#w79w4">NOEOLWRAP</a>)
00165         {
00166             <a class="code" href="class_g_term.html#d12">move_cursor</a>(<a class="code" href="class_g_term.html#r0">width</a> - 1, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00167         }
00168         <span class="keywordflow">else</span>
00169         {
00170             <a class="code" href="class_g_term.html#d33">next_line</a>();
00171         }
00172     }
00173 }
00174 
<a name="l00175"></a><a class="code" href="class_g_term.html#d25">00175</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d25">GTerm::bs</a>()
00176 {
00177     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r13">cursor_x</a>&gt;0)
00178         <a class="code" href="class_g_term.html#d12">move_cursor</a>(<a class="code" href="class_g_term.html#r13">cursor_x</a> - 1, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00179 
00180     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r20">mode_flags</a> &amp; <a class="code" href="class_g_term.html#w79w11">DESTRUCTBS</a>)
00181     {
00182         <a class="code" href="class_g_term.html#d10">clear_area</a>(<a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00183     }
00184 }
00185 
<a name="l00186"></a><a class="code" href="class_g_term.html#d23">00186</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d23">GTerm::bell</a>() { <a class="code" href="class_g_term.html#a30">Bell</a>();
00187 }
00188 
<a name="l00189"></a><a class="code" href="class_g_term.html#d17">00189</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d17">GTerm::clear_param</a>()
00190 {
00191     <a class="code" href="class_g_term.html#r36">nparam</a> = 0;
00192 
00193     memset(<a class="code" href="class_g_term.html#r37">param</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="class_g_term.html#r37">param</a>));
00194     <a class="code" href="class_g_term.html#r40">q_mode</a> = 0;
00195     <a class="code" href="class_g_term.html#r41">got_param</a> = 0;
00196 }
00197 
<a name="l00198"></a><a class="code" href="class_g_term.html#d26">00198</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d26">GTerm::keypad_numeric</a>() { <a class="code" href="class_g_term.html#a22">clear_mode_flag</a>(<a class="code" href="class_g_term.html#w79w9">KEYAPPMODE</a>);
00199 }
00200 
<a name="l00201"></a><a class="code" href="class_g_term.html#d27">00201</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d27">GTerm::keypad_application</a>() { <a class="code" href="class_g_term.html#a21">set_mode_flag</a>(<a class="code" href="class_g_term.html#w79w9">KEYAPPMODE</a>);
00202 }
00203 
<a name="l00204"></a><a class="code" href="class_g_term.html#d28">00204</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d28">GTerm::save_cursor</a>()
00205 {
00206     <a class="code" href="class_g_term.html#r17">save_attrib</a> = <a class="code" href="class_g_term.html#r20">mode_flags</a>;
00207 
00208     <a class="code" href="class_g_term.html#r15">save_x</a> = <a class="code" href="class_g_term.html#r13">cursor_x</a>;
00209     <a class="code" href="class_g_term.html#r16">save_y</a> = <a class="code" href="class_g_term.html#r14">cursor_y</a>;
00210 }
00211 
<a name="l00212"></a><a class="code" href="class_g_term.html#d29">00212</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d29">GTerm::restore_cursor</a>()
00213 {
00214     <a class="code" href="class_g_term.html#r20">mode_flags</a> = (<a class="code" href="class_g_term.html#r20">mode_flags</a> &amp; ~15) | (<a class="code" href="class_g_term.html#r17">save_attrib</a> &amp; 15);
00215 
00216     <a class="code" href="class_g_term.html#d12">move_cursor</a>(<a class="code" href="class_g_term.html#r15">save_x</a>, <a class="code" href="class_g_term.html#r16">save_y</a>);
00217 }
00218 
<a name="l00219"></a><a class="code" href="class_g_term.html#d30">00219</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d30">GTerm::set_tab</a>() { <a class="code" href="class_g_term.html#r21">tab_stops</a>[<a class="code" href="class_g_term.html#r13">cursor_x</a>] = 1;
00220 }
00221 
<a name="l00222"></a><a class="code" href="class_g_term.html#d31">00222</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d31">GTerm::index_down</a>() { <a class="code" href="class_g_term.html#d21">lf</a>();
00223 }
00224 
<a name="l00225"></a><a class="code" href="class_g_term.html#d33">00225</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d33">GTerm::next_line</a>()
00226 {
00227     <a class="code" href="class_g_term.html#d21">lf</a>();
00228 
00229     <a class="code" href="class_g_term.html#d20">cr</a>();
00230 }
00231 
<a name="l00232"></a><a class="code" href="class_g_term.html#d32">00232</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d32">GTerm::index_up</a>()
00233 {
00234     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r14">cursor_y</a>&gt;<a class="code" href="class_g_term.html#r2">scroll_top</a>)
00235     {
00236         <a class="code" href="class_g_term.html#d12">move_cursor</a>(<a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r14">cursor_y</a> - 1);
00237     }
00238     <span class="keywordflow">else</span>
00239     {
00240         <a class="code" href="class_g_term.html#d8">scroll_region</a>(<a class="code" href="class_g_term.html#r2">scroll_top</a>, <a class="code" href="class_g_term.html#r3">scroll_bot</a>, -1);
00241 
00242         <a class="code" href="class_g_term.html#r5">tm</a>.<a class="code" href="class_text_manager.html#a26">Scroll</a>(1, <span class="keyword">true</span>);
00243     }
00244 }
00245 
<a name="l00246"></a><a class="code" href="class_g_term.html#d34">00246</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d34">GTerm::reset</a>()
00247 {
00248     <span class="keywordtype">int</span> i;
00249 
00250     <a class="code" href="class_g_term.html#r10">pending_scroll</a> = 0;
00251     <a class="code" href="class_g_term.html#r19">bg_color</a> = 0;
00252     <a class="code" href="class_g_term.html#r18">fg_color</a> = 7;
00253     <a class="code" href="class_g_term.html#r2">scroll_top</a> = 0;
00254     <a class="code" href="class_g_term.html#r3">scroll_bot</a> = <a class="code" href="class_g_term.html#r1">height</a> - 1;
00255 
00256     <span class="keywordflow">for</span> (i = 0; i&lt;<a class="code" href="gterm_8hpp.html#a1">MAXHEIGHT</a>; i++)
00257         <a class="code" href="class_g_term.html#r7">linenumbers</a>[i] = i;
00258 
00259     memset(<a class="code" href="class_g_term.html#r21">tab_stops</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="class_g_term.html#r21">tab_stops</a>));
00260     <a class="code" href="class_g_term.html#r22">current_state</a> = <a class="code" href="class_g_term.html#v0">GTerm::normal_state</a>;
00261 
00262     <a class="code" href="class_g_term.html#a22">clear_mode_flag</a>(<a class="code" href="class_g_term.html#w79w4">NOEOLWRAP</a> | <a class="code" href="class_g_term.html#w79w5">CURSORAPPMODE</a> | <a class="code" href="class_g_term.html#w79w6">CURSORRELATIVE</a> | <a class="code" href="class_g_term.html#w79w7">NEWLINE</a> | <a class="code" href="class_g_term.html#w79w8">INSERT</a> | <a class="code" href="class_g_term.html#w79w2">UNDERLINE</a> | <a class="code" href="class_g_term.html#w79w1">BLINK</a> | <a class="code" href="class_g_term.html#w79w9">KEYAPPMODE</a>
00263                               | <a class="code" href="class_g_term.html#w79w14">CURSORINVISIBLE</a>);
00264 
00265     <a class="code" href="class_g_term.html#d10">clear_area</a>(0, 0, <a class="code" href="class_g_term.html#r0">width</a> - 1, <a class="code" href="class_g_term.html#r1">height</a> - 1);
00266     <a class="code" href="class_g_term.html#d12">move_cursor</a>(0, 0);
00267 
00268     <a class="code" href="class_g_term.html#r5">tm</a>.<a class="code" href="class_text_manager.html#a28">Reset</a>();
00269 }
00270 
<a name="l00271"></a><a class="code" href="class_g_term.html#d15">00271</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d15">GTerm::set_q_mode</a>() { <a class="code" href="class_g_term.html#r40">q_mode</a> = 1;
00272 }
00273 
00274 <span class="comment">// The verification test used some strange sequence which was </span>
00275 <span class="comment">// ^[[61"p</span>
00276 <span class="comment">// in a function called set_level,</span>
00277 <span class="comment">// but it didn't explain the meaning.  Just in case I ever find out,</span>
00278 <span class="comment">// and just so that it doesn't leave garbage on the screen, I accept</span>
00279 <span class="comment">// the quote and mark a flag.</span>
<a name="l00280"></a><a class="code" href="class_g_term.html#d16">00280</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d16">GTerm::set_quote_mode</a>() { <a class="code" href="class_g_term.html#r42">quote_mode</a> = 1;
00281 }
00282 
00283 <span class="comment">// for performance, this grabs all digits</span>
<a name="l00284"></a><a class="code" href="class_g_term.html#d18">00284</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d18">GTerm::param_digit</a>()
00285 {
00286     <a class="code" href="class_g_term.html#r41">got_param</a> = 1;
00287 
00288     <a class="code" href="class_g_term.html#r37">param</a>[<a class="code" href="class_g_term.html#r36">nparam</a>] = <a class="code" href="class_g_term.html#r37">param</a>[<a class="code" href="class_g_term.html#r36">nparam</a>] * 10 + ( * input_data)-<span class="charliteral">'0'</span>;
00289 }
00290 
<a name="l00291"></a><a class="code" href="class_g_term.html#d19">00291</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d19">GTerm::next_param</a>() { <a class="code" href="class_g_term.html#r36">nparam</a>++;
00292 }
00293 
<a name="l00294"></a><a class="code" href="class_g_term.html#d35">00294</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d35">GTerm::cursor_left</a>()
00295 {
00296     <span class="keywordtype">int</span> n, x;
00297 
00298     n = <a class="code" href="class_g_term.html#r37">param</a>[0];
00299 
00300     <span class="keywordflow">if</span> (n&lt;1)
00301         n = 1;
00302 
00303     x = <a class="code" href="class_g_term.html#r13">cursor_x</a> - n;
00304 
00305     <span class="keywordflow">if</span> (x&lt;0)
00306         x = 0;
00307 
00308     <a class="code" href="class_g_term.html#d12">move_cursor</a>(x, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00309 }
00310 
<a name="l00311"></a><a class="code" href="class_g_term.html#d37">00311</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d37">GTerm::cursor_right</a>()
00312 {
00313     <span class="keywordtype">int</span> n, x;
00314 
00315     n = <a class="code" href="class_g_term.html#r37">param</a>[0];
00316 
00317     <span class="keywordflow">if</span> (n&lt;1)
00318         n = 1;
00319 
00320     x = <a class="code" href="class_g_term.html#r13">cursor_x</a> + n;
00321 
00322     <span class="keywordflow">if</span> (x&gt;=<a class="code" href="class_g_term.html#r0">width</a>)
00323         x = <a class="code" href="class_g_term.html#r0">width</a> - 1;
00324 
00325     <a class="code" href="class_g_term.html#d12">move_cursor</a>(x, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00326 }
00327 
<a name="l00328"></a><a class="code" href="class_g_term.html#d38">00328</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d38">GTerm::cursor_up</a>()
00329 {
00330     <span class="keywordtype">int</span> n, y;
00331 
00332     n = <a class="code" href="class_g_term.html#r37">param</a>[0];
00333 
00334     <span class="keywordflow">if</span> (n&lt;1)
00335         n = 1;
00336 
00337     y = <a class="code" href="class_g_term.html#r14">cursor_y</a> - n;
00338 
00339     <span class="keywordflow">if</span> (y&lt;0)
00340         y = 0;
00341 
00342     <a class="code" href="class_g_term.html#d12">move_cursor</a>(<a class="code" href="class_g_term.html#r13">cursor_x</a>, y);
00343 }
00344 
<a name="l00345"></a><a class="code" href="class_g_term.html#d36">00345</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d36">GTerm::cursor_down</a>()
00346 {
00347     <span class="keywordtype">int</span> n, y;
00348 
00349     n = <a class="code" href="class_g_term.html#r37">param</a>[0];
00350 
00351     <span class="keywordflow">if</span> (n&lt;1)
00352         n = 1;
00353 
00354     y = <a class="code" href="class_g_term.html#r14">cursor_y</a> + n;
00355 
00356     <span class="keywordflow">if</span> (y&gt;=<a class="code" href="class_g_term.html#r1">height</a>)
00357         y = <a class="code" href="class_g_term.html#r1">height</a> - 1;
00358 
00359     <a class="code" href="class_g_term.html#d12">move_cursor</a>(<a class="code" href="class_g_term.html#r13">cursor_x</a>, y);
00360 }
00361 
<a name="l00362"></a><a class="code" href="class_g_term.html#d39">00362</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d39">GTerm::cursor_position</a>()
00363 {
00364     <span class="keywordtype">int</span> x, y;
00365 
00366     x = <a class="code" href="class_g_term.html#r37">param</a>[1];
00367 
00368     <span class="keywordflow">if</span> (x&lt;1)
00369         x = 1;
00370 
00371     y = param[0];
00372 
00373     <span class="keywordflow">if</span> (y&lt;1)
00374         y = 1;
00375 
00376     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r20">mode_flags</a> &amp; <a class="code" href="class_g_term.html#w79w6">CURSORRELATIVE</a>)
00377     {
00378         <a class="code" href="class_g_term.html#d12">move_cursor</a>(x - 1, y - 1 + <a class="code" href="class_g_term.html#r2">scroll_top</a>);
00379     }
00380     <span class="keywordflow">else</span>
00381     {
00382         <a class="code" href="class_g_term.html#d12">move_cursor</a>(x - 1, y - 1);
00383     }
00384 }
00385 
<a name="l00386"></a><a class="code" href="class_g_term.html#d40">00386</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d40">GTerm::device_attrib</a>()
00387 {
00388     <span class="keywordtype">char</span> * str = <span class="stringliteral">"\033[?1;2c"</span>;
00389 
00390     <a class="code" href="class_g_term.html#a3">ProcessOutput</a>(strlen(str), (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * )str);
00391 }
00392 
<a name="l00393"></a><a class="code" href="class_g_term.html#d41">00393</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d41">GTerm::delete_char</a>()
00394 {
00395     <span class="keywordtype">int</span> n, mx;
00396 
00397     n = <a class="code" href="class_g_term.html#r37">param</a>[0];
00398 
00399     <span class="keywordflow">if</span> (n&lt;1)
00400         n = 1;
00401 
00402     mx = <a class="code" href="class_g_term.html#r0">width</a> - <a class="code" href="class_g_term.html#r13">cursor_x</a>;
00403 
00404     <span class="keywordflow">if</span> (n&gt;=mx)
00405     {
00406         <a class="code" href="class_g_term.html#d10">clear_area</a>(<a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r0">width</a> - 1, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00407     }
00408     <span class="keywordflow">else</span>
00409     {
00410         <a class="code" href="class_g_term.html#d9">shift_text</a>(<a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r0">width</a> - 1, -n);
00411     }
00412 }
00413 
<a name="l00414"></a><a class="code" href="class_g_term.html#d42">00414</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d42">GTerm::set_mode</a>() <span class="comment">// h</span>
00415 {
00416     <span class="keywordflow">switch</span> (<a class="code" href="class_g_term.html#r37">param</a>[0] + 1000 * <a class="code" href="class_g_term.html#r40">q_mode</a>)
00417     {
00418         <span class="keywordflow">case</span> 1007:
00419             <a class="code" href="class_g_term.html#a22">clear_mode_flag</a>(<a class="code" href="class_g_term.html#w79w4">NOEOLWRAP</a>);
00420             <span class="keywordflow">break</span>;
00421 
00422         <span class="keywordflow">case</span> 1001:
00423             <a class="code" href="class_g_term.html#a21">set_mode_flag</a>(<a class="code" href="class_g_term.html#w79w5">CURSORAPPMODE</a>);
00424             <span class="keywordflow">break</span>;
00425 
00426         <span class="keywordflow">case</span> 1006:
00427             <a class="code" href="class_g_term.html#a21">set_mode_flag</a>(<a class="code" href="class_g_term.html#w79w6">CURSORRELATIVE</a>);
00428             <span class="keywordflow">break</span>;
00429 
00430         <span class="keywordflow">case</span> 4:
00431             <a class="code" href="class_g_term.html#a21">set_mode_flag</a>(<a class="code" href="class_g_term.html#w79w8">INSERT</a>);
00432             <span class="keywordflow">break</span>;
00433 
00434         <span class="keywordflow">case</span> 1003:
00435             <a class="code" href="class_g_term.html#a31">RequestSizeChange</a>(132, <a class="code" href="class_g_term.html#r1">height</a>);
00436             <span class="keywordflow">break</span>;
00437 
00438         <span class="keywordflow">case</span> 20:
00439             <a class="code" href="class_g_term.html#a21">set_mode_flag</a>(<a class="code" href="class_g_term.html#w79w7">NEWLINE</a>);
00440             <span class="keywordflow">break</span>;
00441 
00442         <span class="keywordflow">case</span> 12:
00443             <a class="code" href="class_g_term.html#a22">clear_mode_flag</a>(<a class="code" href="class_g_term.html#w79w13">LOCALECHO</a>);
00444             <span class="keywordflow">break</span>;
00445 
00446         <span class="keywordflow">case</span> 1025:
00447             <a class="code" href="class_g_term.html#a22">clear_mode_flag</a>(<a class="code" href="class_g_term.html#w79w14">CURSORINVISIBLE</a>);
00448             <a class="code" href="class_g_term.html#d12">move_cursor</a>(<a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00449             <span class="keywordflow">break</span>;
00450     }
00451 }
00452 
<a name="l00453"></a><a class="code" href="class_g_term.html#d43">00453</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d43">GTerm::clear_mode</a>() <span class="comment">// l</span>
00454 {
00455     <span class="keywordflow">switch</span> (<a class="code" href="class_g_term.html#r37">param</a>[0] + 1000 * <a class="code" href="class_g_term.html#r40">q_mode</a>)
00456     {
00457         <span class="keywordflow">case</span> 1007:
00458             <a class="code" href="class_g_term.html#a21">set_mode_flag</a>(<a class="code" href="class_g_term.html#w79w4">NOEOLWRAP</a>);
00459             <span class="keywordflow">break</span>;
00460 
00461         <span class="keywordflow">case</span> 1001:
00462             <a class="code" href="class_g_term.html#a22">clear_mode_flag</a>(<a class="code" href="class_g_term.html#w79w5">CURSORAPPMODE</a>);
00463             <span class="keywordflow">break</span>;
00464 
00465         <span class="keywordflow">case</span> 1006:
00466             <a class="code" href="class_g_term.html#a22">clear_mode_flag</a>(<a class="code" href="class_g_term.html#w79w6">CURSORRELATIVE</a>);
00467             <span class="keywordflow">break</span>;
00468 
00469         <span class="keywordflow">case</span> 4:
00470             <a class="code" href="class_g_term.html#a22">clear_mode_flag</a>(<a class="code" href="class_g_term.html#w79w8">INSERT</a>);
00471             <span class="keywordflow">break</span>;
00472 
00473         <span class="keywordflow">case</span> 1003:
00474             <a class="code" href="class_g_term.html#a31">RequestSizeChange</a>(80, <a class="code" href="class_g_term.html#r1">height</a>);
00475             <span class="keywordflow">break</span>;
00476 
00477         <span class="keywordflow">case</span> 20:
00478             <a class="code" href="class_g_term.html#a22">clear_mode_flag</a>(<a class="code" href="class_g_term.html#w79w7">NEWLINE</a>);
00479             <span class="keywordflow">break</span>;
00480 
00481         <span class="keywordflow">case</span> 1002:
00482             <a class="code" href="class_g_term.html#r22">current_state</a> = <a class="code" href="class_g_term.html#v6">vt52_normal_state</a>;
00483             <span class="keywordflow">break</span>;
00484 
00485         <span class="keywordflow">case</span> 12:
00486             <a class="code" href="class_g_term.html#a21">set_mode_flag</a>(<a class="code" href="class_g_term.html#w79w13">LOCALECHO</a>);
00487             <span class="keywordflow">break</span>;
00488 
00489         <span class="keywordflow">case</span> 1025:
00490             <a class="code" href="class_g_term.html#a21">set_mode_flag</a>(<a class="code" href="class_g_term.html#w79w14">CURSORINVISIBLE</a>);
00491             <span class="keywordflow">break</span>;
00492             <a class="code" href="class_g_term.html#d12">move_cursor</a>(<a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00493             <span class="keywordflow">break</span>;
00494     }
00495 }
00496 
<a name="l00497"></a><a class="code" href="class_g_term.html#d44">00497</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d44">GTerm::request_param</a>()
00498 {
00499     <span class="keywordtype">char</span> str[40];
00500 
00501     sprintf(str, <span class="stringliteral">"\033[%d;1;1;120;120;1;0x"</span>, <a class="code" href="class_g_term.html#r37">param</a>[0] + 2);
00502     <a class="code" href="class_g_term.html#a3">ProcessOutput</a>(strlen(str), (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * )str);
00503 }
00504 
<a name="l00505"></a><a class="code" href="class_g_term.html#d45">00505</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d45">GTerm::set_margins</a>()
00506 {
00507     <span class="keywordtype">int</span> t, b;
00508 
00509     t = <a class="code" href="class_g_term.html#r37">param</a>[0];
00510 
00511     <span class="keywordflow">if</span> (t&lt;1)
00512         t = 1;
00513 
00514     b = param[1];
00515 
00516     <span class="keywordflow">if</span> (b&lt;1)
00517         b = <a class="code" href="class_g_term.html#r1">height</a>;
00518 
00519     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r10">pending_scroll</a>)
00520         <a class="code" href="class_g_term.html#d7">update_changes</a>();
00521 
00522     <a class="code" href="class_g_term.html#r2">scroll_top</a> = t - 1;
00523     <a class="code" href="class_g_term.html#r3">scroll_bot</a> = b - 1;
00524 
00525     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r14">cursor_y</a>&lt;<a class="code" href="class_g_term.html#r2">scroll_top</a>)
00526         <a class="code" href="class_g_term.html#d12">move_cursor</a>(<a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r2">scroll_top</a>);
00527 
00528     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r14">cursor_y</a>&gt;<a class="code" href="class_g_term.html#r3">scroll_bot</a>)
00529         <a class="code" href="class_g_term.html#d12">move_cursor</a>(<a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r3">scroll_bot</a>);
00530 }
00531 
<a name="l00532"></a><a class="code" href="class_g_term.html#d46">00532</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d46">GTerm::delete_line</a>()
00533 {
00534     <span class="keywordtype">int</span> n, mx;
00535 
00536     n = <a class="code" href="class_g_term.html#r37">param</a>[0];
00537 
00538     <span class="keywordflow">if</span> (n&lt;1)
00539         n = 1;
00540 
00541     mx = <a class="code" href="class_g_term.html#r3">scroll_bot</a> - <a class="code" href="class_g_term.html#r14">cursor_y</a> + 1;
00542 
00543     <span class="keywordflow">if</span> (n&gt;=mx)
00544     {
00545         <a class="code" href="class_g_term.html#d10">clear_area</a>(0, <a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r0">width</a> - 1, <a class="code" href="class_g_term.html#r3">scroll_bot</a>);
00546     }
00547     <span class="keywordflow">else</span>
00548     {
00549         <a class="code" href="class_g_term.html#d8">scroll_region</a>(<a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r3">scroll_bot</a>, n);
00550     }
00551 }
00552 
<a name="l00553"></a><a class="code" href="class_g_term.html#d47">00553</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d47">GTerm::status_report</a>()
00554 {
00555     <span class="keywordtype">char</span> str[20];
00556 
00557     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r37">param</a>[0] == 5)
00558     {
00559         <span class="keywordtype">char</span> * str = <span class="stringliteral">"\033[0n"</span>;
00560 
00561         <a class="code" href="class_g_term.html#a3">ProcessOutput</a>(strlen(str), (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * )str);
00562     }
00563     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r37">param</a>[0] == 6)
00564     {
00565         sprintf(str, <span class="stringliteral">"\033[%d;%dR"</span>, <a class="code" href="class_g_term.html#r14">cursor_y</a> + 1, <a class="code" href="class_g_term.html#r13">cursor_x</a> + 1);
00566 
00567         <a class="code" href="class_g_term.html#a3">ProcessOutput</a>(strlen(str), (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * )str);
00568     }
00569 }
00570 
<a name="l00571"></a><a class="code" href="class_g_term.html#d48">00571</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d48">GTerm::erase_display</a>()
00572 {
00573     <span class="keywordflow">switch</span> (<a class="code" href="class_g_term.html#r37">param</a>[0])
00574     {
00575         <span class="keywordflow">case</span> 0:
00576             <a class="code" href="class_g_term.html#d10">clear_area</a>(<a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r0">width</a> - 1, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00577 
00578             <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r14">cursor_y</a>&lt;<a class="code" href="class_g_term.html#r1">height</a> - 1)
00579             {
00580                 <a class="code" href="class_g_term.html#d10">clear_area</a>(0, <a class="code" href="class_g_term.html#r14">cursor_y</a> + 1, <a class="code" href="class_g_term.html#r0">width</a> - 1, <a class="code" href="class_g_term.html#r1">height</a> - 1);
00581             }
00582             <span class="keywordflow">break</span>;
00583 
00584         <span class="keywordflow">case</span> 1:
00585             <a class="code" href="class_g_term.html#d10">clear_area</a>(0, <a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00586 
00587             <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r14">cursor_y</a>&gt;0)
00588             {
00589                 <a class="code" href="class_g_term.html#d10">clear_area</a>(0, 0, <a class="code" href="class_g_term.html#r0">width</a> - 1, <a class="code" href="class_g_term.html#r14">cursor_y</a> - 1);
00590             }
00591             <span class="keywordflow">break</span>;
00592 
00593         <span class="keywordflow">case</span> 2:
00594             <a class="code" href="class_g_term.html#d10">clear_area</a>(0, 0, <a class="code" href="class_g_term.html#r0">width</a> - 1, <a class="code" href="class_g_term.html#r1">height</a> - 1);
00595             <span class="keywordflow">break</span>;
00596     }
00597 }
00598 
<a name="l00599"></a><a class="code" href="class_g_term.html#d49">00599</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d49">GTerm::erase_line</a>()
00600 {
00601     <span class="keywordflow">switch</span> (<a class="code" href="class_g_term.html#r37">param</a>[0])
00602     {
00603         <span class="keywordflow">case</span> 0:
00604             <a class="code" href="class_g_term.html#d10">clear_area</a>(<a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r0">width</a> - 1, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00605             <span class="keywordflow">break</span>;
00606 
00607         <span class="keywordflow">case</span> 1:
00608             <a class="code" href="class_g_term.html#d10">clear_area</a>(0, <a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00609             <span class="keywordflow">break</span>;
00610 
00611         <span class="keywordflow">case</span> 2:
00612             <a class="code" href="class_g_term.html#d10">clear_area</a>(0, <a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r0">width</a> - 1, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00613             <span class="keywordflow">break</span>;
00614     }
00615 }
00616 
<a name="l00617"></a><a class="code" href="class_g_term.html#d50">00617</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d50">GTerm::insert_line</a>()
00618 {
00619     <span class="keywordtype">int</span> n, mx;
00620 
00621     n = <a class="code" href="class_g_term.html#r37">param</a>[0];
00622 
00623     <span class="keywordflow">if</span> (n&lt;1)
00624         n = 1;
00625 
00626     mx = <a class="code" href="class_g_term.html#r3">scroll_bot</a> - <a class="code" href="class_g_term.html#r14">cursor_y</a> + 1;
00627 
00628     <span class="keywordflow">if</span> (n&gt;=mx)
00629     {
00630         <a class="code" href="class_g_term.html#d10">clear_area</a>(0, <a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r0">width</a> - 1, <a class="code" href="class_g_term.html#r3">scroll_bot</a>);
00631     }
00632     <span class="keywordflow">else</span>
00633     {
00634         <a class="code" href="class_g_term.html#d8">scroll_region</a>(<a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r3">scroll_bot</a>, -n);
00635     }
00636 }
00637 
<a name="l00638"></a><a class="code" href="class_g_term.html#d51">00638</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d51">GTerm::set_colors</a>()
00639 {
00640     <span class="keywordtype">int</span> n;
00641 
00642     <span class="keywordflow">if</span> (!<a class="code" href="class_g_term.html#r36">nparam</a> &amp;&amp; <a class="code" href="class_g_term.html#r37">param</a>[0] == 0)
00643     {
00644         <a class="code" href="class_g_term.html#a22">clear_mode_flag</a>(15);
00645 
00646         <a class="code" href="class_g_term.html#r18">fg_color</a> = 7;
00647         <a class="code" href="class_g_term.html#r19">bg_color</a> = 0;
00648         <span class="keywordflow">return</span>;
00649     }
00650 
00651     <span class="keywordflow">for</span> (n = 0; n&lt;=<a class="code" href="class_g_term.html#r36">nparam</a>; n++)
00652     {
00653         <span class="keywordflow">if</span> (param[n] / 10 == 4)
00654         {
00655             <a class="code" href="class_g_term.html#r19">bg_color</a> = param[n] % 10;
00656         }
00657         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (param[n] / 10 == 3)
00658         {
00659             <a class="code" href="class_g_term.html#r18">fg_color</a> = param[n] % 10;
00660         }
00661         <span class="keywordflow">else</span>
00662             <span class="keywordflow">switch</span> (param[n])
00663             {
00664                 <span class="keywordflow">case</span> 0:
00665                     <a class="code" href="class_g_term.html#a22">clear_mode_flag</a>(15);
00666                     <a class="code" href="class_g_term.html#r18">fg_color</a> = 7;
00667                     <a class="code" href="class_g_term.html#r19">bg_color</a> = 0;
00668                     <span class="keywordflow">break</span>;
00669 
00670                 <span class="keywordflow">case</span> 1:
00671                     <a class="code" href="class_g_term.html#a21">set_mode_flag</a>(<a class="code" href="class_g_term.html#w79w0">BOLD</a>);
00672                     <span class="keywordflow">break</span>;
00673 
00674                 <span class="keywordflow">case</span> 4:
00675                     <a class="code" href="class_g_term.html#a21">set_mode_flag</a>(<a class="code" href="class_g_term.html#w79w2">UNDERLINE</a>);
00676                     <span class="keywordflow">break</span>;
00677 
00678                 <span class="keywordflow">case</span> 5:
00679                     <a class="code" href="class_g_term.html#a21">set_mode_flag</a>(<a class="code" href="class_g_term.html#w79w1">BLINK</a>);
00680                     <span class="keywordflow">break</span>;
00681 
00682                 <span class="keywordflow">case</span> 7:
00683                     <a class="code" href="class_g_term.html#a21">set_mode_flag</a>(<a class="code" href="class_g_term.html#w79w3">INVERSE</a>);
00684                     <span class="keywordflow">break</span>;
00685             }
00686     }
00687 }
00688 
<a name="l00689"></a><a class="code" href="class_g_term.html#d52">00689</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d52">GTerm::clear_tab</a>()
00690 {
00691     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r37">param</a>[0] == 3)
00692     {
00693         memset(<a class="code" href="class_g_term.html#r21">tab_stops</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="class_g_term.html#r21">tab_stops</a>));
00694     }
00695     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r37">param</a>[0] == 0)
00696     {
00697         <a class="code" href="class_g_term.html#r21">tab_stops</a>[<a class="code" href="class_g_term.html#r13">cursor_x</a>] = 0;
00698     }
00699 }
00700 
<a name="l00701"></a><a class="code" href="class_g_term.html#d53">00701</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d53">GTerm::insert_char</a>()
00702 {
00703     <span class="keywordtype">int</span> n, mx;
00704 
00705     n = <a class="code" href="class_g_term.html#r37">param</a>[0];
00706 
00707     <span class="keywordflow">if</span> (n&lt;1)
00708         n = 1;
00709 
00710     mx = <a class="code" href="class_g_term.html#r0">width</a> - <a class="code" href="class_g_term.html#r13">cursor_x</a>;
00711 
00712     <span class="keywordflow">if</span> (n&gt;=mx)
00713     {
00714         <a class="code" href="class_g_term.html#d10">clear_area</a>(<a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r0">width</a> - 1, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00715     }
00716     <span class="keywordflow">else</span>
00717     {
00718         <a class="code" href="class_g_term.html#d9">shift_text</a>(<a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r0">width</a> - 1, n);
00719     }
00720 }
00721 
<a name="l00722"></a><a class="code" href="class_g_term.html#d54">00722</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d54">GTerm::screen_align</a>()
00723 {
00724     <span class="keywordtype">int</span> y, yp, x, c;
00725 
00726     c = <a class="code" href="class_g_term.html#d13">calc_color</a>(7, 0, 0);
00727 
00728     <span class="keywordflow">for</span> (y = 0; y&lt;<a class="code" href="class_g_term.html#r1">height</a>; y++)
00729     {
00730         yp = <a class="code" href="class_g_term.html#r7">linenumbers</a>[y] * <a class="code" href="gterm_8hpp.html#a0">MAXWIDTH</a>;
00731         <span class="keywordtype">int</span> altY = <a class="code" href="class_g_term.html#r12">m_nextLineCounter</a> * <a class="code" href="gterm_8hpp.html#a0">MAXWIDTH</a>;
00732 
00733         <a class="code" href="class_g_term.html#d11">changed_line</a>(y, 0, <a class="code" href="class_g_term.html#r0">width</a> - 1);
00734 
00735         <span class="keywordflow">for</span> (x = 0; x&lt;<a class="code" href="class_g_term.html#r0">width</a>; x++)
00736         {
00737             <span class="comment">//text[yp + x] = 'E';</span>
00738 
00739             <a class="code" href="class_g_term.html#r5">tm</a>[y][x] = <span class="charliteral">'E'</span>;
00740 
00741             <span class="comment">//color[yp + x] = c;</span>
00742 
00743             <a class="code" href="class_g_term.html#r5">tm</a>.<a class="code" href="class_text_manager.html#a19">SetColorAdjusted</a>(y, x, c);
00744         }
00745     }
00746 }
00747 
<a name="l00748"></a><a class="code" href="class_g_term.html#d55">00748</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d55">GTerm::erase_char</a>()
00749 {
00750     <span class="keywordtype">int</span> n, mx;
00751 
00752     n = <a class="code" href="class_g_term.html#r37">param</a>[0];
00753 
00754     <span class="keywordflow">if</span> (n&lt;1)
00755         n = 1;
00756 
00757     mx = <a class="code" href="class_g_term.html#r0">width</a> - <a class="code" href="class_g_term.html#r13">cursor_x</a>;
00758 
00759     <span class="keywordflow">if</span> (n&gt;mx)
00760         n = mx;
00761 
00762     <a class="code" href="class_g_term.html#d10">clear_area</a>(<a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r13">cursor_x</a> + n - 1, <a class="code" href="class_g_term.html#r14">cursor_y</a>);
00763     <a class="code" href="class_g_term.html#r5">tm</a>[<a class="code" href="class_g_term.html#r14">cursor_y</a>].replace(<a class="code" href="class_g_term.html#r13">cursor_x</a>, n - 1, n -1, <span class="charliteral">' '</span>);
00764 }
00765 
<a name="l00766"></a><a class="code" href="class_g_term.html#d56">00766</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d56">GTerm::vt52_cursory</a>()
00767 {
00768     <span class="comment">// store y coordinate</span>
00769     <a class="code" href="class_g_term.html#r37">param</a>[0] = ( * input_data)-32;
00770 
00771     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r37">param</a>[0]&lt;0)
00772         <a class="code" href="class_g_term.html#r37">param</a>[0] = 0;
00773 
00774     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r37">param</a>[0]&gt;=<a class="code" href="class_g_term.html#r1">height</a>)
00775         <a class="code" href="class_g_term.html#r37">param</a>[0] = <a class="code" href="class_g_term.html#r1">height</a> - 1;
00776 }
00777 
<a name="l00778"></a><a class="code" href="class_g_term.html#d57">00778</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d57">GTerm::vt52_cursorx</a>()
00779 {
00780     <span class="keywordtype">int</span> x;
00781 
00782     x = ( * input_data)-32;
00783 
00784     <span class="keywordflow">if</span> (x&lt;0)
00785         x = 0;
00786 
00787     <span class="keywordflow">if</span> (x&gt;=<a class="code" href="class_g_term.html#r0">width</a>)
00788         x = <a class="code" href="class_g_term.html#r0">width</a> - 1;
00789 
00790     <a class="code" href="class_g_term.html#d12">move_cursor</a>(x, <a class="code" href="class_g_term.html#r37">param</a>[0]);
00791 }
00792 
<a name="l00793"></a><a class="code" href="class_g_term.html#d58">00793</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d58">GTerm::vt52_ident</a>()
00794 {
00795     <span class="keywordtype">char</span> * str = <span class="stringliteral">"\033/Z"</span>;
00796 
00797     <a class="code" href="class_g_term.html#a3">ProcessOutput</a>(strlen(str), (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * )str);
00798 }
00799 
00800 <span class="preprocessor">#ifdef GTERM_PC</span>
00801 <span class="preprocessor"></span>
<a name="l00802"></a><a class="code" href="class_g_term.html#d2">00802</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d2">GTerm::pc_begin</a>( <span class="keywordtype">void</span> )
00803 {
00804     <span class="comment">//printf("pc_begin...\n");</span>
00805     <a class="code" href="class_g_term.html#a21">set_mode_flag</a>(<a class="code" href="class_g_term.html#w79w15">PC</a>);
00806 
00807     <span class="comment">//printf("pc_begin: mode_flags = %x\n", mode_flags);</span>
00808     <a class="code" href="class_g_term.html#a3">ProcessOutput</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)strlen(<a class="code" href="class_g_term.html#r34">pc_machinename</a>) + 1, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * )pc_machinename);
00809     <a class="code" href="class_g_term.html#r31">pc_oldWidth</a> = <a class="code" href="class_g_term.html#a5">Width</a>();
00810     <a class="code" href="class_g_term.html#r32">pc_oldHeight</a> = <a class="code" href="class_g_term.html#a6">Height</a>();
00811     <a class="code" href="class_g_term.html#a4">ResizeTerminal</a>(80, 25);
00812     <a class="code" href="class_g_term.html#d7">update_changes</a>();
00813 }
00814 
<a name="l00815"></a><a class="code" href="class_g_term.html#d3">00815</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d3">GTerm::pc_end</a>( <span class="keywordtype">void</span> )
00816 {
00817     <span class="comment">//  printf("pc_end...\n");</span>
00818     <a class="code" href="class_g_term.html#a22">clear_mode_flag</a>(<a class="code" href="class_g_term.html#w79w15">PC</a>);
00819 
00820     <a class="code" href="class_g_term.html#a4">ResizeTerminal</a>(<a class="code" href="class_g_term.html#r31">pc_oldWidth</a>, <a class="code" href="class_g_term.html#r32">pc_oldHeight</a>);
00821     <a class="code" href="class_g_term.html#d7">update_changes</a>();
00822 }
00823 
<a name="l00824"></a><a class="code" href="class_g_term.html#d4">00824</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d4">GTerm::pc_cmd</a>( <span class="keywordtype">void</span> )
00825 {
00826     <a class="code" href="class_g_term.html#r26">pc_curcmd</a> = * <a class="code" href="class_g_term.html#r38">input_data</a>;
00827 
00828     <span class="comment">//printf("pc_cmd: pc_curcmd = %d...\n", pc_curcmd);</span>
00829     <a class="code" href="class_g_term.html#r28">pc_argcount</a> = 0;
00830 
00831     <span class="keywordflow">switch</span> (<a class="code" href="class_g_term.html#r26">pc_curcmd</a>)
00832     {
00833         <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a7">GTERM_PC_CMD_CURONOFF</a>: <span class="comment">// &lt;on/off&gt;</span>
00834             <a class="code" href="class_g_term.html#r27">pc_numargs</a> = 1;
00835             <span class="keywordflow">break</span>;
00836 
00837         <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a8">GTERM_PC_CMD_MOVECURSOR</a>: <span class="comment">// &lt;x&gt; &lt;y&gt;</span>
00838             <a class="code" href="class_g_term.html#r27">pc_numargs</a> = 2;
00839             <span class="keywordflow">break</span>;
00840 
00841         <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a9">GTERM_PC_CMD_PUTTEXT</a>: <span class="comment">// &lt;x&gt; &lt;y&gt; &lt;wid&gt; &lt;len&gt;</span>
00842             <a class="code" href="class_g_term.html#r27">pc_numargs</a> = 4;
00843             <span class="keywordflow">break</span>;
00844 
00845         <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a10">GTERM_PC_CMD_WRITE</a>: <span class="comment">// &lt;x&gt; &lt;y&gt; &lt;wid&gt; &lt;attr&gt;</span>
00846             <a class="code" href="class_g_term.html#r27">pc_numargs</a> = 4;
00847             <span class="keywordflow">break</span>;
00848 
00849         <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a11">GTERM_PC_CMD_MOVETEXT</a>: <span class="comment">// &lt;sx&gt; &lt;sy&gt; &lt;wid&gt; &lt;len&gt; &lt;dx&gt; &lt;dy&gt;</span>
00850             <a class="code" href="class_g_term.html#r27">pc_numargs</a> = 6;
00851             <span class="keywordflow">break</span>;
00852 
00853         <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a12">GTERM_PC_CMD_BEEP</a>:
00854             <a class="code" href="class_g_term.html#a30">Bell</a>();
00855             <span class="keywordflow">break</span>;
00856 
00857         <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a13">GTERM_PC_CMD_SELECTPRINTER</a>:
00858             <a class="code" href="class_g_term.html#r27">pc_numargs</a> = 1;
00859             <span class="keywordflow">break</span>;
00860 
00861         <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a14">GTERM_PC_CMD_PRINTCHAR</a>:
00862             <a class="code" href="class_g_term.html#r27">pc_numargs</a> = 1;
00863             <span class="keywordflow">break</span>;
00864 
00865         <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a15">GTERM_PC_CMD_PRINTCHARS</a>:
00866             <a class="code" href="class_g_term.html#r27">pc_numargs</a> = 2;
00867             <span class="keywordflow">break</span>;
00868 
00869         <span class="keywordflow">default</span>:
00870             <a class="code" href="class_g_term.html#r22">current_state</a> = <a class="code" href="class_g_term.html#v16">pc_cmd_state</a>;
00871             <span class="keywordflow">break</span>;
00872     }
00873 }
00874 
<a name="l00875"></a><a class="code" href="class_g_term.html#d5">00875</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d5">GTerm::pc_arg</a>( <span class="keywordtype">void</span> )
00876 {
00877     <span class="keywordtype">int</span> i, yp, yp2;
00878 
00879     <span class="comment">//printf("pc_arg: pc_curcmd = %d...\n", pc_curcmd);</span>
00880 
00881     <a class="code" href="class_g_term.html#r33">pc_args</a>[<a class="code" href="class_g_term.html#r28">pc_argcount</a>++ ] = * <a class="code" href="class_g_term.html#r38">input_data</a>;
00882 
00883     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r28">pc_argcount</a> == <a class="code" href="class_g_term.html#r27">pc_numargs</a>)
00884     {
00885         <span class="keywordflow">switch</span> (<a class="code" href="class_g_term.html#r26">pc_curcmd</a>)
00886         {
00887             <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a7">GTERM_PC_CMD_CURONOFF</a>:
00888                 <span class="comment">//printf("pc_arg: curonoff got %d\n", *input_data);</span>
00889                 <span class="keywordflow">if</span> (* input_data)
00890                     <a class="code" href="class_g_term.html#a22">clear_mode_flag</a>(<a class="code" href="class_g_term.html#w79w14">CURSORINVISIBLE</a>);
00891                 <span class="keywordflow">else</span>
00892                     <a class="code" href="class_g_term.html#a21">set_mode_flag</a>(<a class="code" href="class_g_term.html#w79w14">CURSORINVISIBLE</a>);
00893 
00894                 <a class="code" href="class_g_term.html#r22">current_state</a> = <a class="code" href="class_g_term.html#v16">pc_cmd_state</a>;
00895                 <a class="code" href="class_g_term.html#d11">changed_line</a>(<a class="code" href="class_g_term.html#r14">cursor_y</a>, <a class="code" href="class_g_term.html#r13">cursor_x</a>, <a class="code" href="class_g_term.html#r13">cursor_x</a>);
00896                 <span class="keywordflow">break</span>;
00897 
00898             <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a8">GTERM_PC_CMD_MOVECURSOR</a>:
00899                 <span class="comment">//printf("pc_arg: movecursor (%d, %d)\n", pc_args[0], pc_args[1]);</span>
00900                 <a class="code" href="class_g_term.html#d12">move_cursor</a>(<a class="code" href="class_g_term.html#r33">pc_args</a>[0], <a class="code" href="class_g_term.html#r33">pc_args</a>[1]);
00901                 <a class="code" href="class_g_term.html#r22">current_state</a> = pc_cmd_state;
00902                 <span class="keywordflow">break</span>;
00903 
00904             <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a9">GTERM_PC_CMD_PUTTEXT</a>:
00905                 <span class="comment">//printf("pc_arg: puttext got %d, %d, %d, %d\n", pc_args[0], pc_args[1], pc_args[2], pc_args[3]);      </span>
00906                 <a class="code" href="class_g_term.html#r29">pc_numdata</a> = <a class="code" href="class_g_term.html#r33">pc_args</a>[2] * pc_args[3] * 2;
00907                 <a class="code" href="class_g_term.html#r30">pc_datacount</a> = 0;
00908                 <a class="code" href="class_g_term.html#r24">pc_curx</a> = pc_args[0];
00909                 <a class="code" href="class_g_term.html#r23">pc_cury</a> = pc_args[1];
00910 
00911                 <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r29">pc_numdata</a>)
00912                     <a class="code" href="class_g_term.html#r22">current_state</a> = <a class="code" href="class_g_term.html#v18">pc_data_state</a>;
00913                 <span class="keywordflow">else</span>
00914                     <a class="code" href="class_g_term.html#r22">current_state</a> = pc_cmd_state;
00915 
00916                 <span class="keywordflow">break</span>;
00917 
00918             <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a10">GTERM_PC_CMD_WRITE</a>:
00919                 <span class="comment">//printf("pc_arg: write got %d, %d, %d, %d\n", pc_args[0], pc_args[1], pc_args[2], pc_args[3]);      </span>
00920                 <a class="code" href="class_g_term.html#r29">pc_numdata</a> = pc_args[2];
00921                 <a class="code" href="class_g_term.html#r30">pc_datacount</a> = 0;
00922                 <a class="code" href="class_g_term.html#r24">pc_curx</a> = pc_args[0];
00923                 <a class="code" href="class_g_term.html#r23">pc_cury</a> = pc_args[1];
00924 
00925                 <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r29">pc_numdata</a>)
00926                     <a class="code" href="class_g_term.html#r22">current_state</a> = pc_data_state;
00927                 <span class="keywordflow">else</span>
00928                     <a class="code" href="class_g_term.html#r22">current_state</a> = pc_cmd_state;
00929 
00930                 <span class="keywordflow">break</span>;
00931 
00932             <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a11">GTERM_PC_CMD_MOVETEXT</a>: <span class="comment">// &lt;sx&gt; &lt;sy&gt; &lt;wid&gt; &lt;len&gt; &lt;dx&gt; &lt;dy&gt;</span>
00933                 <span class="keywordflow">if</span> (pc_args[1]&lt;pc_args[5])
00934                 {
00935                     <span class="keywordflow">for</span> (i = 0; i&lt;pc_args[3]; i++)
00936                     {
00937                         <span class="keywordtype">int</span> idx1 = pc_args[1] + i;
00938                         yp = <a class="code" href="class_g_term.html#r7">linenumbers</a>[idx1] * <a class="code" href="gterm_8hpp.html#a0">MAXWIDTH</a>;
00939 
00940                         <span class="keywordtype">int</span> idx2 = pc_args[5] + i;
00941                         yp2 = linenumbers[idx2] * <a class="code" href="gterm_8hpp.html#a0">MAXWIDTH</a>;
00942 
00943                         memmove(&amp; <a class="code" href="class_g_term.html#r4">text</a>[yp2 + pc_args[4]], &amp; <a class="code" href="class_g_term.html#r4">text</a>[yp + pc_args[0]], pc_args[2]);
00944                         
00945                         string substring = <a class="code" href="class_g_term.html#r5">tm</a>[idx1].substr(pc_args[0], pc_args[2]);
00946                         tm[idx2].replace(pc_args[4], pc_args[2], substring);
00947 
00948                         memmove(&amp; <a class="code" href="class_g_term.html#r6">color</a>[yp2 + pc_args[4]], &amp; <a class="code" href="class_g_term.html#r6">color</a>[yp + pc_args[0]], pc_args[2]);
00949                         <span class="comment">// TODO Doesn't seem to get here in normal use, but probably ought to</span>
00950                         <span class="comment">//      eventually figure out what's going on so I can manipulate the text manager here</span>
00951                         <a class="code" href="class_g_term.html#d11">changed_line</a>(pc_args[5] + i, pc_args[4], pc_args[4] + pc_args[2] - 1);
00952                     }
00953                 }
00954                 <span class="keywordflow">else</span>
00955                 {
00956                     <span class="keywordflow">for</span> (i = pc_args[3] - 1; i&gt;=0; i--)
00957                     {
00958                         <span class="keywordtype">int</span> idx1 = pc_args[1] + i;
00959                         yp = <a class="code" href="class_g_term.html#r7">linenumbers</a>[idx1] * <a class="code" href="gterm_8hpp.html#a0">MAXWIDTH</a>;
00960 
00961                         <span class="keywordtype">int</span> idx2 = pc_args[5] + i;
00962                         yp2 = linenumbers[idx2] * <a class="code" href="gterm_8hpp.html#a0">MAXWIDTH</a>;
00963 
00964                         memmove(&amp; <a class="code" href="class_g_term.html#r4">text</a>[yp2 + pc_args[4]], &amp; <a class="code" href="class_g_term.html#r4">text</a>[yp + pc_args[0]], pc_args[2]);
00965 
00966                         string substring = <a class="code" href="class_g_term.html#r5">tm</a>[idx1].substr(pc_args[0], pc_args[2]);
00967                         tm[idx2].replace(pc_args[4], pc_args[2], substring);
00968 
00969                         memmove(&amp; <a class="code" href="class_g_term.html#r6">color</a>[yp2 + pc_args[4]], &amp; <a class="code" href="class_g_term.html#r6">color</a>[yp + pc_args[0]], pc_args[2]);
00970                         <span class="comment">// TODO ditto as with previous</span>
00971                         <a class="code" href="class_g_term.html#d11">changed_line</a>(pc_args[5] + i, pc_args[4], pc_args[4] + pc_args[2] - 1);
00972                     }
00973                 }
00974 
00975                 <a class="code" href="class_g_term.html#r22">current_state</a> = pc_cmd_state;
00976                 <span class="keywordflow">break</span>;
00977 
00978             <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a13">GTERM_PC_CMD_SELECTPRINTER</a>:
00979                 <a class="code" href="class_g_term.html#r29">pc_numdata</a> = pc_args[0];
00980                 <a class="code" href="class_g_term.html#r30">pc_datacount</a> = 0;
00981                 memset(<a class="code" href="class_g_term.html#r35">pc_printername</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="class_g_term.html#r35">pc_printername</a>));
00982 
00983                 <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r29">pc_numdata</a>)
00984                     <a class="code" href="class_g_term.html#r22">current_state</a> = pc_data_state;
00985                 <span class="keywordflow">else</span>
00986                 {
00987                     <a class="code" href="class_g_term.html#a33">SelectPrinter</a>(<span class="stringliteral">""</span>);
00988 
00989                     <a class="code" href="class_g_term.html#r22">current_state</a> = pc_cmd_state;
00990                 }
00991 
00992                 <span class="keywordflow">break</span>;
00993 
00994             <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a14">GTERM_PC_CMD_PRINTCHAR</a>:
00995                 <a class="code" href="class_g_term.html#a34">PrintChars</a>(1, &amp; pc_args[0]);
00996                 <a class="code" href="class_g_term.html#r22">current_state</a> = pc_cmd_state;
00997                 <span class="keywordflow">break</span>;
00998 
00999             <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a15">GTERM_PC_CMD_PRINTCHARS</a>:
01000                 <a class="code" href="class_g_term.html#r29">pc_numdata</a> = (pc_args[0] &lt;&lt; 8) + pc_args[1];
01001                 <a class="code" href="class_g_term.html#r30">pc_datacount</a> = 0;
01002 
01003                 <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r29">pc_numdata</a>)
01004                     <a class="code" href="class_g_term.html#r22">current_state</a> = pc_data_state;
01005                 <span class="keywordflow">else</span>
01006                     <a class="code" href="class_g_term.html#r22">current_state</a> = pc_cmd_state;
01007 
01008                 <span class="keywordflow">break</span>;
01009         }
01010     }
01011 }
01012 
<a name="l01013"></a><a class="code" href="class_g_term.html#d6">01013</a> <span class="keywordtype">void</span> <a class="code" href="class_g_term.html#d6">GTerm::pc_data</a>( <span class="keywordtype">void</span> )
01014 {
01015     <span class="keywordtype">int</span> yp;
01016     <span class="keywordtype">int</span> altY;
01017 
01018     <span class="comment">//printf("pc_data: pc_curcmd = %d, pc_datacount = %d, pc_numdata = %d, pc_curx = %d, pc_cur_y = %d...\n", pc_curcmd, pc_datacount, pc_numdata, pc_curx, pc_cury);      </span>
01019     <span class="keywordflow">switch</span> (<a class="code" href="class_g_term.html#r26">pc_curcmd</a>)
01020     {
01021         <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a9">GTERM_PC_CMD_PUTTEXT</a>:
01022             yp = <a class="code" href="class_g_term.html#r7">linenumbers</a>[<a class="code" href="class_g_term.html#r23">pc_cury</a>] * <a class="code" href="gterm_8hpp.html#a0">MAXWIDTH</a>;
01023 
01024             altY = <a class="code" href="class_g_term.html#r12">m_nextLineCounter</a> * <a class="code" href="gterm_8hpp.html#a0">MAXWIDTH</a>;
01025 
01026             <span class="keywordflow">if</span> (!(<a class="code" href="class_g_term.html#r30">pc_datacount</a> &amp; 1))
01027             {
01028                 <span class="comment">//printf("pc_data: got char %d\n", *input_data);      </span>
01029                 <span class="comment">//text[yp + pc_curx] = * input_data;</span>
01030 
01031                 <a class="code" href="class_g_term.html#r5">tm</a>[<a class="code" href="class_g_term.html#r23">pc_cury</a>][<a class="code" href="class_g_term.html#r24">pc_curx</a>] = *<a class="code" href="class_g_term.html#r38">input_data</a>;
01032             }
01033             <span class="keywordflow">else</span>
01034             {
01035                 <span class="comment">//printf("pc_data: got attr %d\n", *input_data);</span>
01036                 <span class="comment">//color[yp + pc_curx] = * input_data &lt;&lt; 4;</span>
01037                 <a class="code" href="class_g_term.html#r5">tm</a>.<a class="code" href="class_text_manager.html#a19">SetColorAdjusted</a>(<a class="code" href="class_g_term.html#r23">pc_cury</a>, <a class="code" href="class_g_term.html#r24">pc_curx</a>, (*<a class="code" href="class_g_term.html#r38">input_data</a> &lt;&lt; 4));
01038             }
01039 
01040             <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r30">pc_datacount</a> &amp; 1)
01041             {
01042                 <a class="code" href="class_g_term.html#d11">changed_line</a>(<a class="code" href="class_g_term.html#r23">pc_cury</a>, <a class="code" href="class_g_term.html#r33">pc_args</a>[0], <a class="code" href="class_g_term.html#r24">pc_curx</a>);
01043 
01044                 <a class="code" href="class_g_term.html#r24">pc_curx</a>++;
01045 
01046                 <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r24">pc_curx</a> == <a class="code" href="class_g_term.html#r33">pc_args</a>[0] + pc_args[2])
01047                 {
01048                     <a class="code" href="class_g_term.html#r24">pc_curx</a> = pc_args[0];
01049 
01050                     <a class="code" href="class_g_term.html#r23">pc_cury</a>++;
01051                 }
01052             }
01053 
01054             <span class="keywordflow">break</span>;
01055 
01056         <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a10">GTERM_PC_CMD_WRITE</a>:
01057             yp = linenumbers[<a class="code" href="class_g_term.html#r23">pc_cury</a>] * <a class="code" href="gterm_8hpp.html#a0">MAXWIDTH</a>;
01058             altY = <a class="code" href="class_g_term.html#r12">m_nextLineCounter</a> * <a class="code" href="gterm_8hpp.html#a0">MAXWIDTH</a>;
01059 
01060             <span class="comment">//text[yp + pc_curx] = * input_data;</span>
01061             <a class="code" href="class_g_term.html#r5">tm</a>[<a class="code" href="class_g_term.html#r23">pc_cury</a>][<a class="code" href="class_g_term.html#r24">pc_curx</a>] = *<a class="code" href="class_g_term.html#r38">input_data</a>;
01062 
01063             <span class="comment">//color[yp + pc_curx] = (unsigned short)pc_args[3] &lt;&lt; 4;</span>
01064             <a class="code" href="class_g_term.html#r5">tm</a>.<a class="code" href="class_text_manager.html#a19">SetColorAdjusted</a>(<a class="code" href="class_g_term.html#r23">pc_cury</a>, <a class="code" href="class_g_term.html#r24">pc_curx</a>, ((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)<a class="code" href="class_g_term.html#r33">pc_args</a>[3] &lt;&lt; 4) );
01065             <a class="code" href="class_g_term.html#d11">changed_line</a>(<a class="code" href="class_g_term.html#r23">pc_cury</a>, pc_args[0], <a class="code" href="class_g_term.html#r24">pc_curx</a>);
01066             <a class="code" href="class_g_term.html#r24">pc_curx</a>++;
01067             <span class="keywordflow">break</span>;
01068 
01069         <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a13">GTERM_PC_CMD_SELECTPRINTER</a>:
01070             <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r30">pc_datacount</a>&lt;<a class="code" href="gterm_8hpp.html#a16">GTERM_PC_MAXPRINTERNAME</a> - 1)
01071                 <a class="code" href="class_g_term.html#r35">pc_printername</a>[<a class="code" href="class_g_term.html#r30">pc_datacount</a>] = * input_data;
01072 
01073             <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r30">pc_datacount</a> == <a class="code" href="class_g_term.html#r29">pc_numdata</a> - 1)
01074                 <a class="code" href="class_g_term.html#a33">SelectPrinter</a>(<a class="code" href="class_g_term.html#r35">pc_printername</a>);
01075 
01076             <span class="keywordflow">break</span>;
01077 
01078         <span class="keywordflow">case</span> <a class="code" href="gterm_8hpp.html#a15">GTERM_PC_CMD_PRINTCHARS</a>:
01079             <a class="code" href="class_g_term.html#a34">PrintChars</a>(1, input_data);
01080             <span class="keywordflow">break</span>;
01081     }
01082 
01083     <a class="code" href="class_g_term.html#r30">pc_datacount</a>++;
01084 
01085     <span class="keywordflow">if</span> (<a class="code" href="class_g_term.html#r30">pc_datacount</a> == <a class="code" href="class_g_term.html#r29">pc_numdata</a>)
01086         <a class="code" href="class_g_term.html#r22">current_state</a> = <a class="code" href="class_g_term.html#v16">pc_cmd_state</a>;
01087 }
01088 
01089 <span class="preprocessor">#endif // GTERM_PC</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Apr 28 16:45:37 2004 for Chameleon by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
