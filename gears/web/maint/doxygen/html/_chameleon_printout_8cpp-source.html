<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Chameleon: ChameleonPrintout.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>ChameleonPrintout.cpp</h1><a href="_chameleon_printout_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include "<a class="code" href="_chameleon_printout_8h.html">ChameleonPrintout.h</a>"</span>
00002 <span class="preprocessor">#include "../editor/editor.h"</span>
00003 <span class="preprocessor">#include "wx/printdlg.h"</span>  <span class="comment">// wxPageSetupDialog</span>
00004 <span class="preprocessor">#include "wx/progdlg.h"</span>   <span class="comment">// wxProgressDialog</span>
00005 
00006 <span class="preprocessor">#include "<a class="code" href="debug_8h.html">debug.h</a>"</span>
00007 
00008 
00009 <span class="preprocessor">#ifdef _DEBUG</span>
00010 <span class="preprocessor"></span><span class="preprocessor">#define new DEBUG_NEW</span>
00011 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00012 <span class="preprocessor"></span>
00013 
<a name="l00014"></a><a class="code" href="_chameleon_printout_8cpp.html#a0">00014</a> <span class="keyword">extern</span> wxPrintData *<a class="code" href="_chameleon_printout_8cpp.html#a0">g_printData</a>;
<a name="l00015"></a><a class="code" href="_chameleon_printout_8cpp.html#a1">00015</a> <span class="keyword">extern</span> wxPageSetupData *<a class="code" href="_chameleon_printout_8cpp.html#a1">g_pageSetupData</a>;
00016 
<a name="l00017"></a><a class="code" href="class_chameleon_printout.html#a0">00017</a> <a class="code" href="class_chameleon_printout.html#a0">ChameleonPrintout::ChameleonPrintout</a> (<a class="code" href="class_chameleon_editor.html">ChameleonEditor</a> *edit, wxChar *title)
00018 : wxPrintout(title) {
00019     <a class="code" href="class_chameleon_printout.html#r0">m_edit</a> = edit;
00020     <a class="code" href="class_chameleon_printout.html#r1">m_printed</a> = 0;
00021 
00022 }
00023 
<a name="l00034"></a><a class="code" href="class_chameleon_printout.html#a1">00034</a> <span class="keywordtype">bool</span> <a class="code" href="class_chameleon_printout.html#a1">ChameleonPrintout::OnPrintPage</a> (<span class="keywordtype">int</span> page) {
00035 
00036     wxDC *dc = GetDC();
00037     <span class="keywordflow">if</span> (!dc) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00038 
00039     <span class="comment">// scale DC</span>
00040     <a class="code" href="class_chameleon_printout.html#d0">PrintScaling</a> (dc);
00041 
00042     <span class="comment">// TODO Need to figure out how to preview the appropriate page...</span>
00043     <span class="comment">// right now it just does from the start</span>
00044     <span class="comment">// print page</span>
00045     <span class="keywordflow">if</span> (page == 1) <a class="code" href="class_chameleon_printout.html#r1">m_printed</a> = 0;
00046     <a class="code" href="class_chameleon_printout.html#r1">m_printed</a> = <a class="code" href="class_chameleon_printout.html#r0">m_edit</a>-&gt;FormatRange (1, <a class="code" href="class_chameleon_printout.html#r1">m_printed</a>, <a class="code" href="class_chameleon_printout.html#r0">m_edit</a>-&gt;GetLength(),
00047         dc, dc, <a class="code" href="class_chameleon_printout.html#r3">m_printRect</a>, <a class="code" href="class_chameleon_printout.html#r2">m_pageRect</a>);
00048 
00049     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00050 }
00051 
<a name="l00063"></a><a class="code" href="class_chameleon_printout.html#a2">00063</a> <span class="keywordtype">bool</span> <a class="code" href="class_chameleon_printout.html#a2">ChameleonPrintout::OnBeginDocument</a> (<span class="keywordtype">int</span> startPage, <span class="keywordtype">int</span> endPage) {
00064 
00065     <a class="code" href="class_chameleon_printout.html#r1">m_printed</a> = 0;
00066     <span class="keywordflow">if</span> (!wxPrintout::OnBeginDocument (startPage, endPage)) {
00067         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00068     }
00069 
00070     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00071 }
00072 
<a name="l00086"></a><a class="code" href="class_chameleon_printout.html#a4">00086</a> <span class="keywordtype">void</span> <a class="code" href="class_chameleon_printout.html#a4">ChameleonPrintout::GetPageInfo</a> (<span class="keywordtype">int</span> *minPage, <span class="keywordtype">int</span> *maxPage, <span class="keywordtype">int</span> *selPageFrom, <span class="keywordtype">int</span> *selPageTo) {
00087 
00088     <span class="comment">// initialize values</span>
00089     *minPage = 0;
00090     *maxPage = 0;
00091     *selPageFrom = 0;
00092     *selPageTo = 0;
00093 
00094     <span class="comment">// scale DC if possible</span>
00095     wxDC *dc = GetDC();
00096     <span class="keywordflow">if</span> (!dc) <span class="keywordflow">return</span>;
00097     <a class="code" href="class_chameleon_printout.html#d0">PrintScaling</a> (dc);
00098 
00099     <span class="comment">// get print page informations and convert to printer pixels</span>
00100     wxSize ppiScr;
00101     GetPPIScreen (&amp;ppiScr.x, &amp;ppiScr.y);
00102     wxSize page = <a class="code" href="_chameleon_printout_8cpp.html#a1">g_pageSetupData</a>-&gt;GetPaperSize();
00103     page.x = static_cast&lt;int&gt; (page.x * ppiScr.x / 25.4);
00104     page.y = static_cast&lt;int&gt; (page.y * ppiScr.y / 25.4);
00105     <a class="code" href="class_chameleon_printout.html#r2">m_pageRect</a> = wxRect (0,
00106         0,
00107         page.x,
00108         page.y);
00109 
00110     <span class="comment">// get margins informations and convert to printer pixels</span>
00111     <span class="keywordtype">int</span>  top = 25; <span class="comment">// default 25</span>
00112     <span class="keywordtype">int</span>  bottom = 25; <span class="comment">// default 25</span>
00113     <span class="keywordtype">int</span>  left = 20; <span class="comment">// default 20</span>
00114     <span class="keywordtype">int</span>  right = 20; <span class="comment">// default 20</span>
00115     wxPoint (top, left) = <a class="code" href="_chameleon_printout_8cpp.html#a1">g_pageSetupData</a>-&gt;GetMarginTopLeft();
00116     wxPoint (bottom, right) = <a class="code" href="_chameleon_printout_8cpp.html#a1">g_pageSetupData</a>-&gt;GetMarginBottomRight();
00117     top = static_cast&lt;int&gt; (top * ppiScr.y / 25.4);
00118     bottom = static_cast&lt;int&gt; (bottom * ppiScr.y / 25.4);
00119     left = static_cast&lt;int&gt; (left * ppiScr.x / 25.4);
00120     right = static_cast&lt;int&gt; (right * ppiScr.x / 25.4);
00121     <a class="code" href="class_chameleon_printout.html#r3">m_printRect</a> = wxRect (left,
00122         top,
00123         page.x - (left + right),
00124         page.y - (top + bottom));
00125 
00126     <span class="comment">// count pages</span>
00127     <span class="keywordflow">while</span> (<a class="code" href="class_chameleon_printout.html#a3">HasPage</a> (*maxPage)) {
00128         <a class="code" href="class_chameleon_printout.html#r1">m_printed</a> = <a class="code" href="class_chameleon_printout.html#r0">m_edit</a>-&gt;FormatRange (0, <a class="code" href="class_chameleon_printout.html#r1">m_printed</a>, <a class="code" href="class_chameleon_printout.html#r0">m_edit</a>-&gt;GetLength(),
00129             dc, dc, <a class="code" href="class_chameleon_printout.html#r3">m_printRect</a>, <a class="code" href="class_chameleon_printout.html#r2">m_pageRect</a>);
00130         *maxPage += 1;
00131     }
00132     <span class="keywordflow">if</span> (*maxPage &gt; 0) *minPage = 1;
00133     *selPageFrom = *minPage;
00134     *selPageTo = *maxPage;
00135 }
00136 
00147 <span class="keywordtype">bool</span> <a class="code" href="class_chameleon_printout.html#a3">ChameleonPrintout::HasPage</a> (<span class="keywordtype">int</span> WXUNUSED(page)) {
00148 
00149     <span class="keywordflow">return</span> (m_printed &lt; m_edit-&gt;GetLength());
00150 }
00151 
<a name="l00162"></a><a class="code" href="class_chameleon_printout.html#d0">00162</a> <span class="keywordtype">bool</span> <a class="code" href="class_chameleon_printout.html#d0">ChameleonPrintout::PrintScaling</a> (wxDC *dc){
00163 
00164     <span class="comment">// check for dc, return if none</span>
00165     <span class="keywordflow">if</span> (!dc) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00166 
00167     <span class="comment">// get printer and screen sizing values</span>
00168     wxSize ppiScr;
00169     GetPPIScreen (&amp;ppiScr.x, &amp;ppiScr.y);
00170     <span class="keywordflow">if</span> (ppiScr.x == 0) { <span class="comment">// most possible guess 96 dpi</span>
00171         ppiScr.x = 96;
00172         ppiScr.y = 96;
00173     }
00174     wxSize ppiPrt;
00175     GetPPIPrinter (&amp;ppiPrt.x, &amp;ppiPrt.y);
00176     <span class="keywordflow">if</span> (ppiPrt.x == 0) { <span class="comment">// scaling factor to 1</span>
00177         ppiPrt.x = ppiScr.x;
00178         ppiPrt.y = ppiScr.y;
00179     }
00180     wxSize dcSize = dc-&gt;GetSize();
00181     wxSize pageSize;
00182     GetPageSizePixels (&amp;pageSize.x, &amp;pageSize.y);
00183 
00184     <span class="comment">// set user scale</span>
00185     <span class="keywordtype">float</span> scale_x = (<span class="keywordtype">float</span>)(ppiPrt.x * dcSize.x) /
00186         (<span class="keywordtype">float</span>)(ppiScr.x * pageSize.x);
00187     <span class="keywordtype">float</span> scale_y = (<span class="keywordtype">float</span>)(ppiPrt.y * dcSize.y) /
00188         (<span class="keywordtype">float</span>)(ppiScr.y * pageSize.y);
00189     dc-&gt;SetUserScale (scale_x, scale_y);
00190 
00191     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00192 }
00193 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Apr 28 16:45:38 2004 for Chameleon by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
