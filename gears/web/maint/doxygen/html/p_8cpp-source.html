<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Chameleon: p.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>p.cpp</h1><a href="p_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*******************\</span>
00002 <span class="comment">*Permissions Manager*</span>
00003 <span class="comment">\*******************/</span>
00004 <span class="comment">//Source code for the permissions manager header file, created for the</span>
00005 <span class="comment">//Chameleon Flex IDE.</span>
00006 <span class="comment">//Author: Ben Carhart</span>
00007 <span class="comment">//Date started: 11/22/03</span>
00008 <span class="comment">//Date officially completed: --/--/--</span>
00009 <span class="comment">//Description: manages the handling of permissions</span>
00010 <span class="comment">//Major revisions:</span>
00011 <span class="comment">//  ~BSC--xx/xx/xx--Changed the loading of the permCode by using a temp</span>
00012 <span class="comment">//                  bitset variable</span>
00013 <span class="comment">//  ~BSC--xx/xx/xx--Altered the error handling of the program to be</span>
00014 <span class="comment">//                  a little more graceful.</span>
00015 <span class="comment">//  ~BSC--11/29/03--Added the authorization bitset variable &amp; implementation</span>
00016 <span class="comment">//  ~BSC--02/09/04--Removed all file access.  User must pass in the # on</span>
00017 <span class="comment">//                  initialization.  Also # encryption removed.</span>
00018 <span class="comment">//  ~BSC--02/26/04--Changed authorization code to include check-sum for some</span>
00019 <span class="comment">//                  security against kids just randomly changing authorization</span>
00020 <span class="comment">//                  numbers and getting interesting authorized results.  i</span>
00021 <span class="comment">//                  also pulled out the little extra code-checking down in</span>
00022 <span class="comment">//                  "setGlobal()".  Why?  It wasn't working right.</span>
00023 <span class="comment">//  ~BSC--03/20/04--adjusted authorization so that if "adv. comp." is enabled,</span>
00024 <span class="comment">//                  so is "compilation".  I basically put a small "if()...then"</span>
00025 <span class="comment">//                  statement everywhere the [permCode] is somehow modified.  I</span>
00026 <span class="comment">//                  also set it so that if normal compilation is disabled*, ADV</span>
00027 <span class="comment">//                  compilation is disabled.  I didn't touch authorizations.</span>
00028 <span class="comment">//                  *note- this disabling only occurs of "disable(id)" is called.</span>
00029 <span class="comment">//  ~BSC--03/22/04--Adjused for Mark: a blank constructor</span>
00030 <span class="comment">//  ~BSC--04/23/04--blank constructor removed!!  why?  oh we changed things  ^_^</span>
00031 <span class="comment">//                  but this class is essentially done.  I think it can be ignored</span>
00032 <span class="comment">//                  if other items are added later, but i'm not fully sure.  Mark</span>
00033 <span class="comment">//                  and Dave are responsible for adding items, so I never saw what</span>
00034 <span class="comment">//                  Mark had to do per-item-added.</span>
00035 
00036 <span class="comment">//includes</span>
00037 <span class="preprocessor">#include "<a class="code" href="p_8h.html">p.h</a>"</span>
00038 <span class="preprocessor">#include "../common/Crc16.h"</span>
00039 <span class="preprocessor">#include "../common/debug.h"</span>
00040 
00041 <span class="comment">//global variables</span>
00042 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00043 
00044 <span class="preprocessor">#ifdef _DEBUG</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#define new DEBUG_NEW</span>
00046 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00047 <span class="preprocessor"></span>
<a name="l00048"></a><a class="code" href="p_8cpp.html#a0">00048</a> wxString <a class="code" href="p_8cpp.html#a0">GlobalPermStrings</a>[] = {<span class="stringliteral">"Syntax highlighting"</span>, 
00049                                 <span class="stringliteral">"Auto-indentation"</span>,
00050                                 <span class="stringliteral">"Debugging"</span>,
00051                                 <span class="stringliteral">"Terminal"</span>,
00052                                 <span class="stringliteral">"Local mode"</span>,
00053                                 <span class="stringliteral">"Projects"</span>,
00054                                 <span class="stringliteral">"Compilation"</span>,
00055                                 <span class="stringliteral">"Advanced compiler output"</span>,
00056                                 <span class="stringliteral">"Test permission"</span>};
00057 
00058 <span class="comment">//@@@@@@@@@</span>
00059 <span class="comment">//@ BEGIN @</span>
00060 <span class="comment">//@@@@@@@@@</span>
00061 
00062 <span class="comment">//Constructor(s)</span>
00063 
<a name="l00074"></a><a class="code" href="class_permission.html#a0">00074</a> <a class="code" href="class_permission.html#a0">Permission::Permission</a>(wxString loadAuthCode, wxString loadPermCode)
00075 {
00076     <span class="keywordtype">long</span> tPCode, tACode;
00077     
00078     loadPermCode.ToLong(&amp;tPCode);
00079     loadAuthCode.ToLong(&amp;tACode);
00080     
00081     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="datastructures_8h.html#a150a100">PERM_LAST</a>; i++)
00082     {
00083         <a class="code" href="class_permission.html#r4">permNames</a>.Add(<a class="code" href="p_8cpp.html#a0">GlobalPermStrings</a>[i]);
00084     }
00085 
00086     <span class="comment">//load permission code into bitset Array</span>
00087 
00088     bitset&lt;NUM_MODULES&gt; tempP(tPCode);
00089     bitset&lt;NUM_MODULES&gt; tempA(tACode);
00090     status = tempP;
00091     <a class="code" href="class_permission.html#r1">auth</a> = tempA;
00092 
00093     <a class="code" href="class_permission.html#r2">permCode</a> = status.to_ulong();
00094     <a class="code" href="class_permission.html#r3">authCode</a> = <a class="code" href="class_permission.html#r1">auth</a>.to_ulong();
00095 
00096     <span class="keywordflow">if</span>(<a class="code" href="class_permission.html#a2">isEnabled</a>(<a class="code" href="datastructures_8h.html#a150a98">PERM_ADVANCEDCOMPILE</a>))
00097     {
00098         <a class="code" href="class_permission.html#a4">enable</a>(<a class="code" href="datastructures_8h.html#a150a97">PERM_COMPILE</a>);
00099     }
00100 }
00101 
00102 <span class="comment">//Destructor</span>
00103 <span class="comment">//Kills everything.</span>
<a name="l00111"></a><a class="code" href="class_permission.html#a1">00111</a> <span class="comment"></span><a class="code" href="class_permission.html#a1">Permission::~Permission</a>()
00112 {
00113     status.reset();
00114     <a class="code" href="class_permission.html#r1">auth</a>.reset();
00115     <a class="code" href="class_permission.html#r2">permCode</a> = 0;
00116     <a class="code" href="class_permission.html#r3">authCode</a> = 0;
00117 }
00118 
<a name="l00129"></a><a class="code" href="class_permission.html#a2">00129</a> <span class="keywordtype">bool</span> <a class="code" href="class_permission.html#a2">Permission::isEnabled</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>)
00130 {
00131     <span class="keywordflow">return</span>(status.test(<span class="keywordtype">id</span>) &amp;&amp; <a class="code" href="class_permission.html#r1">auth</a>.test(<span class="keywordtype">id</span>));
00132 }
00133 
<a name="l00144"></a><a class="code" href="class_permission.html#a3">00144</a> <span class="keywordtype">bool</span> <a class="code" href="class_permission.html#a3">Permission::isAuthorized</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>)
00145 {
00146     <span class="keywordflow">return</span>(<a class="code" href="class_permission.html#r1">auth</a>.test(<span class="keywordtype">id</span>));
00147 }
00148 
<a name="l00159"></a><a class="code" href="class_permission.html#a4">00159</a> <span class="keywordtype">void</span> <a class="code" href="class_permission.html#a4">Permission::enable</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>)
00160 {
00161     <span class="keywordflow">if</span>(<a class="code" href="class_permission.html#a3">isAuthorized</a>(<span class="keywordtype">id</span>))
00162     {
00163         status.set(<span class="keywordtype">id</span>);
00164         <a class="code" href="class_permission.html#r2">permCode</a> = status.to_ulong();
00165 
00166         <span class="keywordflow">if</span>(<a class="code" href="class_permission.html#a2">isEnabled</a>(<a class="code" href="datastructures_8h.html#a150a98">PERM_ADVANCEDCOMPILE</a>) &amp;&amp; !(<a class="code" href="class_permission.html#a2">isEnabled</a>(<a class="code" href="datastructures_8h.html#a150a97">PERM_COMPILE</a>)))
00167         {
00168             <a class="code" href="class_permission.html#a4">enable</a>(<a class="code" href="datastructures_8h.html#a150a97">PERM_COMPILE</a>);
00169         }
00170     }
00171 
00172 }
00173 
<a name="l00184"></a><a class="code" href="class_permission.html#a5">00184</a> <span class="keywordtype">void</span> <a class="code" href="class_permission.html#a5">Permission::disable</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>)
00185 {
00186     status.reset(<span class="keywordtype">id</span>);
00187     <a class="code" href="class_permission.html#r2">permCode</a> = status.to_ulong();
00188 
00189     <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == <a class="code" href="datastructures_8h.html#a150a97">PERM_COMPILE</a>)
00190     {
00191         status.reset(<a class="code" href="datastructures_8h.html#a150a98">PERM_ADVANCEDCOMPILE</a>);
00192         <a class="code" href="class_permission.html#r2">permCode</a> = status.to_ulong();
00193     }
00194 }
00195 
<a name="l00206"></a><a class="code" href="class_permission.html#a8">00206</a> <span class="keywordtype">bool</span> <a class="code" href="class_permission.html#a8">Permission::setGlobalAuthorized</a>(wxString newAuthCode)
00207 {
00208     wxString crcPrefix;
00209     wxString crcGenerated;
00210     wxString numberString;
00211 
00212     <span class="keywordflow">if</span>(newAuthCode.Len() &lt; 4)
00213     {
00214         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00215     }
00216 
00217     newAuthCode.MakeUpper();
00218     crcPrefix = newAuthCode.Left(4);
00219 
00220     numberString = newAuthCode.Mid(4);
00221     <span class="comment">//wxLogDebug("newAuthCode: %s", newAuthCode);</span>
00222     <span class="comment">//wxLogDebug("numberString: %s", numberString);</span>
00223     <span class="comment">//wxLogDebug("crcPrefix: %s", crcPrefix);</span>
00224 
00225     <a class="code" href="class_cls_crc16.html">ClsCrc16</a> crc;
00226     crc.<a class="code" href="class_cls_crc16.html#a3">CrcInitialize</a>();
00227     crc.<a class="code" href="class_cls_crc16.html#a4">CrcAdd</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)numberString.GetData(), numberString.Len());
00228     
00229     crcGenerated.Printf(<span class="stringliteral">"%X"</span>, crc.<a class="code" href="class_cls_crc16.html#a7">CrcGet</a>());
00230     <span class="comment">//wxLogDebug("crcGenerated: %s", crcGenerated);</span>
00231 
00232     <span class="keywordtype">bool</span> validAuthCode = (crcGenerated == crcPrefix);
00233 
00234     <span class="keywordflow">if</span>(validAuthCode)
00235     {
00236         numberString.ToLong(&amp;<a class="code" href="class_permission.html#r3">authCode</a>);
00237         <a class="code" href="class_permission.html#r1">auth</a> = bitset&lt;NUM_MODULES&gt;(<a class="code" href="class_permission.html#r3">authCode</a>);
00238         <a class="code" href="class_permission.html#r5">savedAuthCode</a> = newAuthCode;
00239     }
00240 
00241     <span class="keywordflow">return</span> validAuthCode;
00242 }
00243 
<a name="l00254"></a><a class="code" href="class_permission.html#a9">00254</a> <span class="keywordtype">void</span> <a class="code" href="class_permission.html#a9">Permission::setGlobalEnabled</a>(wxString newEnableCode)
00255 {
00256     newEnableCode.ToLong(&amp;<a class="code" href="class_permission.html#r2">permCode</a>);
00257     status = bitset&lt;NUM_MODULES&gt;(<a class="code" href="class_permission.html#r2">permCode</a>);
00258 
00259     <span class="keywordflow">if</span>(<a class="code" href="class_permission.html#a2">isEnabled</a>(<a class="code" href="datastructures_8h.html#a150a98">PERM_ADVANCEDCOMPILE</a>))
00260     {
00261         <a class="code" href="class_permission.html#a4">enable</a>(<a class="code" href="datastructures_8h.html#a150a97">PERM_COMPILE</a>);
00262     }
00263 
00264     <a class="code" href="class_permission.html#r6">savedPermCode</a> &lt;&lt; <a class="code" href="class_permission.html#a10">getGlobalEnabled</a>();
00265 }
00266 
<a name="l00275"></a><a class="code" href="class_permission.html#a10">00275</a> <span class="keywordtype">long</span> <a class="code" href="class_permission.html#a10">Permission::getGlobalEnabled</a>()
00276 {
00277     <span class="keywordflow">return</span>(<a class="code" href="class_permission.html#r2">permCode</a>);
00278 }
00279 
<a name="l00288"></a><a class="code" href="class_permission.html#a11">00288</a> <span class="keywordtype">long</span> <a class="code" href="class_permission.html#a11">Permission::getGlobalAuthorized</a>()
00289 {
00290     <span class="keywordflow">return</span>(<a class="code" href="class_permission.html#r3">authCode</a>);
00291 }
00292 
00293 
<a name="l00304"></a><a class="code" href="class_permission.html#a12">00304</a> wxString <a class="code" href="class_permission.html#a12">Permission::getPermName</a>(<span class="keywordtype">int</span> permEnum)
00305 {
00306     
00307     <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)<a class="code" href="class_permission.html#r4">permNames</a>.Count() &gt; permEnum)
00308     {
00309         <span class="keywordflow">return</span> <a class="code" href="class_permission.html#r4">permNames</a>.Item(permEnum);
00310     }
00311     <span class="keywordflow">return</span> wxEmptyString;
00312 }
00313 <span class="comment">//@@@@@@@</span>
00314 <span class="comment">//@ END @</span>
00315 <span class="comment">//@@@@@@@</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Apr 28 16:45:38 2004 for Chameleon by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
