<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Chameleon: ProfOptionsDialog.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>ProfOptionsDialog.cpp</h1><a href="_prof_options_dialog_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">// Name:        ProfOptionsDialog.cpp</span>
00003 <span class="comment">// Purpose:     </span>
00004 <span class="comment">// Author:      </span>
00005 <span class="comment">// Modified by: </span>
00006 <span class="comment">// Created:     02/09/04 19:36:08</span>
00007 <span class="comment">// RCS-ID:      </span>
00008 <span class="comment">// Copyright:   </span>
00009 <span class="comment">// Licence:     </span>
00011 <span class="comment"></span>
00012 <span class="preprocessor">#ifdef __GNUG__</span>
00013 <span class="preprocessor"></span><span class="preprocessor">#pragma implementation "ProfOptionsDialog.cpp"</span>
00014 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00015 <span class="preprocessor"></span>
00016 <span class="comment">// For compilers that support precompilation, includes "wx/wx.h".</span>
00017 <span class="preprocessor">#include "wx/wxprec.h"</span>
00018 
00019 <span class="preprocessor">#ifdef __BORLANDC__</span>
00020 <span class="preprocessor"></span><span class="preprocessor">#pragma hdrstop</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00022 <span class="preprocessor"></span>
00024 <span class="preprocessor">#include "wx/wx.h"</span>
00026 
00027 <span class="preprocessor">#include "<a class="code" href="_prof_options_dialog_8h.html">ProfOptionsDialog.h</a>"</span>
00028 <span class="preprocessor">#include "../perms/p.h"</span>
00029 <span class="preprocessor">#include "../common/Crc16.h"</span>
00030 <span class="preprocessor">#include "../common/fixvsbug.h"</span>
00031 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00032 
00035 
<a name="l00036"></a><a class="code" href="_prof_options_dialog_8cpp.html#a0">00036</a> <span class="keyword">extern</span> wxString <a class="code" href="p_8cpp.html#a0">GlobalPermStrings</a>[];
00037 
00042 IMPLEMENT_CLASS( <a class="code" href="class_prof_options_dialog.html">ProfOptionsDialog</a>, wxDialog )
00043 
00044 
00048 BEGIN_EVENT_TABLE( <a class="code" href="class_prof_options_dialog.html">ProfOptionsDialog</a>, wxDialog )
00049 
00050 
00051     EVT_BUTTON( ID_GENERATE, ProfOptionsDialog::OnGenerateClick )
00052 
00053     EVT_BUTTON( ID_BUTTON, ProfOptionsDialog::OnButtonCheckAllClick )
00054 
00055     EVT_BUTTON( ID_BUTTON1, ProfOptionsDialog::OnButtonUncheckAllClick )
00056 
00057     EVT_BUTTON( ID_BUTTON2, ProfOptionsDialog::OnDecodeClick )
00058 
00059     EVT_BUTTON( ID_EXITBUTTON, ProfOptionsDialog::OnExitbuttonClick )
00060 
00061 
00062 
00063     EVT_CLOSE(ProfOptionsDialog::OnQuit)
00064 
00065 END_EVENT_TABLE()
00066 
00067 #pragma warning( disable : 4267)
00068 
00069 
00070 
00071 
<a name="l00075"></a><a class="code" href="class_prof_options_dialog.html#a0">00075</a> <a class="code" href="class_prof_options_dialog.html#a0">ProfOptionsDialog::ProfOptionsDialog</a>( )
00076 {
00077 }
00078 
<a name="l00079"></a><a class="code" href="class_prof_options_dialog.html#a1">00079</a> <a class="code" href="class_prof_options_dialog.html#a0">ProfOptionsDialog::ProfOptionsDialog</a>( wxWindow* parent, wxWindowID <span class="keywordtype">id</span>, <span class="keyword">const</span> wxString&amp; caption, <span class="keyword">const</span> wxPoint&amp; pos, <span class="keyword">const</span> wxSize&amp; size, <span class="keywordtype">long</span> style )
00080 {
00081     <a class="code" href="class_prof_options_dialog.html#a2">Create</a>(parent, <span class="keywordtype">id</span>, caption, pos, size, style);
00082 }
00083 
<a name="l00088"></a><a class="code" href="class_prof_options_dialog.html#a2">00088</a> <span class="keywordtype">bool</span> <a class="code" href="class_prof_options_dialog.html#a2">ProfOptionsDialog::Create</a>( wxWindow* parent, wxWindowID <span class="keywordtype">id</span>, <span class="keyword">const</span> wxString&amp; caption, <span class="keyword">const</span> wxPoint&amp; pos, <span class="keyword">const</span> wxSize&amp; size, <span class="keywordtype">long</span> style )
00089 {
00092 
00094     wxDialog::Create( parent, <span class="keywordtype">id</span>, caption, pos, size, style );
00095 
00096     <a class="code" href="class_prof_options_dialog.html#a3">CreateControls</a>();
00097     GetSizer()-&gt;Fit(<span class="keyword">this</span>);
00098     GetSizer()-&gt;SetSizeHints(<span class="keyword">this</span>);
00099     Centre();
00101 
00102     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = <a class="code" href="datastructures_8h.html#a150a90">PERM_FIRST</a>; i &lt; <a class="code" href="datastructures_8h.html#a150a100">PERM_LAST</a>; i++)
00103     {
00104         <a class="code" href="class_prof_options_dialog.html#o0">m_chklstModules</a>-&gt;Append(<a class="code" href="p_8cpp.html#a0">GlobalPermStrings</a>[i]);
00105     }
00106 
00107     srand(time(0));
00108     <span class="keywordflow">return</span> TRUE;
00109 }
00110 
<a name="l00115"></a><a class="code" href="class_prof_options_dialog.html#a3">00115</a> <span class="keywordtype">void</span> <a class="code" href="class_prof_options_dialog.html#a3">ProfOptionsDialog::CreateControls</a>()
00116 {    
00118 
00119     <a class="code" href="class_prof_options_dialog.html">ProfOptionsDialog</a>* item1 = <span class="keyword">this</span>;
00120 
00121     wxBoxSizer* item2 = <span class="keyword">new</span> wxBoxSizer(wxVERTICAL);
00122     item1-&gt;SetSizer(item2);
00123     item1-&gt;SetAutoLayout(TRUE);
00124 
00125     wxBoxSizer* item3 = <span class="keyword">new</span> wxBoxSizer(wxHORIZONTAL);
00126     item2-&gt;Add(item3, 0, wxALIGN_CENTER_HORIZONTAL|wxALL, 5);
00127 
00128     wxBoxSizer* item4 = <span class="keyword">new</span> wxBoxSizer(wxVERTICAL);
00129     item3-&gt;Add(item4, 0, wxALIGN_TOP|wxALL, 5);
00130 
00131     wxStaticText* item5 = <span class="keyword">new</span> wxStaticText( item1, wxID_STATIC, _(<span class="stringliteral">"Available modules:"</span>), wxDefaultPosition, wxDefaultSize, 0 );
00132     item4-&gt;Add(item5, 0, wxALIGN_CENTER_HORIZONTAL|wxALL|wxADJUST_MINSIZE, 5);
00133 
00134     wxString* item6Strings = <a class="code" href="_crc16_8h.html#a0">NULL</a>;
00135     wxCheckListBox* item6 = <span class="keyword">new</span> wxCheckListBox( item1, <a class="code" href="_options_dialog_8h.html#a8">ID_CHECKLISTBOX</a>, wxDefaultPosition, wxSize(200, 240), 0, item6Strings, 0 );
00136     <a class="code" href="class_prof_options_dialog.html#o0">m_chklstModules</a> = item6;
00137     item4-&gt;Add(item6, 0, wxALIGN_CENTER_HORIZONTAL|wxLEFT|wxRIGHT|wxBOTTOM, 5);
00138 
00139     wxBoxSizer* item7 = <span class="keyword">new</span> wxBoxSizer(wxVERTICAL);
00140     item3-&gt;Add(item7, 0, wxALIGN_TOP|wxALL, 5);
00141 
00142     wxStaticText* item8 = <span class="keyword">new</span> wxStaticText( item1, wxID_STATIC, _(<span class="stringliteral">"Generated activation code:"</span>), wxDefaultPosition, wxDefaultSize, 0 );
00143     item7-&gt;Add(item8, 0, wxALIGN_LEFT|wxALL|wxADJUST_MINSIZE, 5);
00144 
00145     wxTextCtrl* item9 = <span class="keyword">new</span> wxTextCtrl( item1, <a class="code" href="_prof_options_dialog_8h.html#a2">ID_TXTCODE</a>, _(<span class="stringliteral">""</span>), wxDefaultPosition, wxSize(140, -1), 0 );
00146     <a class="code" href="class_prof_options_dialog.html#o1">m_txtGeneratedCode</a> = item9;
00147     item7-&gt;Add(item9, 0, wxALIGN_LEFT|wxLEFT|wxRIGHT, 5);
00148 
00149     wxButton* item10 = <span class="keyword">new</span> wxButton( item1, <a class="code" href="_prof_options_dialog_8h.html#a3">ID_GENERATE</a>, _(<span class="stringliteral">"Generate code"</span>), wxDefaultPosition, wxSize(90, -1), 0 );
00150     <a class="code" href="class_prof_options_dialog.html#o2">m_genButton</a> = item10;
00151     item7-&gt;Add(item10, 0, wxALIGN_LEFT|wxLEFT|wxRIGHT|wxBOTTOM, 5);
00152 
00153     wxCheckBox* item11 = <span class="keyword">new</span> wxCheckBox( item1, <a class="code" href="_prof_options_dialog_8h.html#a4">ID_RANDOMIZE</a>, _(<span class="stringliteral">"Randomize code"</span>), wxDefaultPosition, wxSize(100, -1), 0 );
00154     <a class="code" href="class_prof_options_dialog.html#o3">m_chkRandomize</a> = item11;
00155     item11-&gt;SetValue(FALSE);
00156     item7-&gt;Add(item11, 0, wxALIGN_LEFT|wxALL, 5);
00157 
00158     wxButton* item12 = <span class="keyword">new</span> wxButton( item1, <a class="code" href="_prof_options_dialog_8h.html#a5">ID_BUTTON</a>, _(<span class="stringliteral">"Check all modules"</span>), wxDefaultPosition, wxSize(120, -1), 0 );
00159     <a class="code" href="class_prof_options_dialog.html#o4">m_butCheckAll</a> = item12;
00160     item7-&gt;Add(item12, 0, wxALIGN_LEFT|wxLEFT|wxRIGHT|wxTOP, 5);
00161 
00162     wxButton* item13 = <span class="keyword">new</span> wxButton( item1, <a class="code" href="_prof_options_dialog_8h.html#a6">ID_BUTTON1</a>, _(<span class="stringliteral">"Uncheck all modules"</span>), wxDefaultPosition, wxSize(120, -1), 0 );
00163     <a class="code" href="class_prof_options_dialog.html#o5">m_butUncheckAll</a> = item13;
00164     item7-&gt;Add(item13, 0, wxALIGN_LEFT|wxLEFT|wxRIGHT|wxBOTTOM, 5);
00165 
00166     wxBoxSizer* item14 = <span class="keyword">new</span> wxBoxSizer(wxHORIZONTAL);
00167     item7-&gt;Add(item14, 0, wxALIGN_CENTER_HORIZONTAL|wxALL, 5);
00168 
00169     wxButton* item15 = <span class="keyword">new</span> wxButton( item1, <a class="code" href="_prof_options_dialog_8h.html#a7">ID_BUTTON2</a>, _(<span class="stringliteral">"Decode:"</span>), wxDefaultPosition, wxSize(90, -1), 0 );
00170     <a class="code" href="class_prof_options_dialog.html#o6">m_decodeButton</a> = item15;
00171     item7-&gt;Add(item15, 0, wxALIGN_LEFT|wxLEFT|wxRIGHT, 5);
00172 
00173     wxTextCtrl* item16 = <span class="keyword">new</span> wxTextCtrl( item1, <a class="code" href="_add_variable_watch_8h.html#a6">ID_TEXTCTRL</a>, _(<span class="stringliteral">""</span>), wxDefaultPosition, wxSize(140, -1), 0 );
00174     <a class="code" href="class_prof_options_dialog.html#o7">m_txtDecode</a> = item16;
00175     item7-&gt;Add(item16, 0, wxALIGN_LEFT|wxLEFT|wxRIGHT, 5);
00176 
00177     wxBoxSizer* item17 = <span class="keyword">new</span> wxBoxSizer(wxHORIZONTAL);
00178     item7-&gt;Add(item17, 0, wxALIGN_CENTER_HORIZONTAL|wxALL, 5);
00179 
00180     wxButton* item18 = <span class="keyword">new</span> wxButton( item1, <a class="code" href="_prof_options_dialog_8h.html#a9">ID_EXITBUTTON</a>, _(<span class="stringliteral">"Exit"</span>), wxDefaultPosition, wxDefaultSize, 0 );
00181     <a class="code" href="class_prof_options_dialog.html#o8">m_exitButton</a> = item18;
00182     item7-&gt;Add(item18, 0, wxALIGN_RIGHT|wxLEFT|wxRIGHT|wxTOP, 5);
00183 
00185 }
00186 
<a name="l00191"></a><a class="code" href="class_prof_options_dialog.html#a4">00191</a> <span class="keywordtype">void</span> <a class="code" href="class_prof_options_dialog.html#a4">ProfOptionsDialog::OnGenerateClick</a>( wxCommandEvent&amp; event )
00192 {
00193     <span class="comment">// Insert custom code here</span>
00194     event.Skip();
00195 
00196     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newCode = 0;
00197 
00198     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="class_prof_options_dialog.html#o0">m_chklstModules</a>-&gt;GetCount(); i++)
00199     {
00200         <span class="keywordflow">if</span>(<a class="code" href="class_prof_options_dialog.html#o0">m_chklstModules</a>-&gt;IsChecked(i))
00201         {
00202             newCode |= 1 &lt;&lt; i;
00203         }
00204     }
00205 
00206     <span class="keywordflow">if</span>(<a class="code" href="class_prof_options_dialog.html#o3">m_chkRandomize</a>-&gt;IsChecked())
00207     {
00208         <span class="keywordtype">int</span> bitcounter = 30;
00209         <span class="keywordflow">for</span>(bitcounter; bitcounter &gt;= <a class="code" href="datastructures_8h.html#a150a100">PERM_LAST</a>; bitcounter--)
00210         {
00211             <span class="keywordflow">if</span>(rand() % 2 == 0)
00212             {
00213                 newCode |= 1 &lt;&lt; bitcounter;
00214             }
00215 
00216         }
00217     }
00218     wxString newAuthCodeString;
00219         
00220 
00221     newAuthCodeString.Printf(<span class="stringliteral">"%u"</span>, newCode);
00222     <span class="keywordflow">if</span>(newAuthCodeString.Len() &lt; 3)
00223     {
00224         newAuthCodeString.Prepend(<span class="stringliteral">"000000"</span>);
00225     }
00226     
00227 
00228     <span class="comment">/*</span>
00229 <span class="comment">    </span>
00230 <span class="comment">    long firstNum;</span>
00231 <span class="comment">    long nextToLastNum;</span>
00232 <span class="comment">    long lastNum;</span>
00233 <span class="comment">    int len = newAuthCodeString.Len();</span>
00234 <span class="comment">    wxString(newAuthCodeString.GetChar(0)).ToLong(&amp;firstNum);</span>
00235 <span class="comment">    wxString(newAuthCodeString.GetChar(len - 2)).ToLong(&amp;nextToLastNum);</span>
00236 <span class="comment">    wxString(newAuthCodeString.GetChar(len - 1)).ToLong(&amp;lastNum);</span>
00237 <span class="comment"></span>
00238 <span class="comment">    long firstResult = firstNum + lastNum;</span>
00239 <span class="comment">    char firstCheckChar = AuthCodeLookupTable[firstResult];</span>
00240 <span class="comment">    </span>
00241 <span class="comment"></span>
00242 <span class="comment">    long secondResult = firstResult + nextToLastNum;</span>
00243 <span class="comment">    if(secondResult &gt; 25)</span>
00244 <span class="comment">    {</span>
00245 <span class="comment">        secondResult -= 26;</span>
00246 <span class="comment">    }</span>
00247 <span class="comment"></span>
00248 <span class="comment">    char secondCheckChar = AuthCodeLookupTable[secondResult];</span>
00249 <span class="comment"></span>
00250 <span class="comment">    char firstRandomChar = (char)( (rand() % 26) + 65);</span>
00251 <span class="comment">    char secondRandomChar = (char)( (rand() % 26) + 65);</span>
00252 <span class="comment">    */</span>
00253 
00254     <a class="code" href="class_cls_crc16.html">ClsCrc16</a> crc;
00255     crc.<a class="code" href="class_cls_crc16.html#a3">CrcInitialize</a>();
00256     crc.<a class="code" href="class_cls_crc16.html#a4">CrcAdd</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(newAuthCodeString.GetData()), newAuthCodeString.Len());
00257     wxString prefixChars;
00258     <span class="comment">//prefixChars &lt;&lt; secondCheckChar &lt;&lt; firstRandomChar &lt;&lt; secondRandomChar &lt;&lt; firstCheckChar;</span>
00259     prefixChars.Printf(<span class="stringliteral">"%X"</span>, crc.<a class="code" href="class_cls_crc16.html#a7">CrcGet</a>());
00260 
00261     newAuthCodeString.Prepend(prefixChars);
00262     
00263     <a class="code" href="class_prof_options_dialog.html#o1">m_txtGeneratedCode</a>-&gt;SetValue(newAuthCodeString);
00264 }
00265 
<a name="l00270"></a><a class="code" href="class_prof_options_dialog.html#a8">00270</a> <span class="keywordtype">void</span> <a class="code" href="class_prof_options_dialog.html#a8">ProfOptionsDialog::OnExitbuttonClick</a>( wxCommandEvent&amp; event )
00271 {
00272     <span class="comment">// Insert custom code here</span>
00273     event.Skip();
00274     Destroy();
00275 }
00276 
<a name="l00281"></a><a class="code" href="class_prof_options_dialog.html#e0">00281</a> <span class="keywordtype">bool</span> <a class="code" href="class_prof_options_dialog.html#e0">ProfOptionsDialog::ShowToolTips</a>()
00282 {
00283   <span class="keywordflow">return</span> TRUE;
00284 }
00285 
<a name="l00286"></a><a class="code" href="class_prof_options_dialog.html#a9">00286</a> <span class="keywordtype">void</span> <a class="code" href="class_prof_options_dialog.html#a9">ProfOptionsDialog::OnQuit</a>(wxCloseEvent &amp;event)
00287 {
00288     Destroy();
00289 }
00290 
<a name="l00295"></a><a class="code" href="class_prof_options_dialog.html#a6">00295</a> <span class="keywordtype">void</span> <a class="code" href="class_prof_options_dialog.html#a6">ProfOptionsDialog::OnButtonUncheckAllClick</a>( wxCommandEvent&amp; event )
00296 {
00297     <span class="comment">// Insert custom code here</span>
00298     event.Skip();
00299     
00300     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="class_prof_options_dialog.html#o0">m_chklstModules</a>-&gt;GetCount(); i++)
00301     {
00302         <a class="code" href="class_prof_options_dialog.html#o0">m_chklstModules</a>-&gt;Check(i, <span class="keyword">false</span>);
00303     }
00304 }
00305 
00306 
<a name="l00311"></a><a class="code" href="class_prof_options_dialog.html#a5">00311</a> <span class="keywordtype">void</span> <a class="code" href="class_prof_options_dialog.html#a5">ProfOptionsDialog::OnButtonCheckAllClick</a>( wxCommandEvent&amp; event )
00312 {
00313     <span class="comment">// Insert custom code here</span>
00314     event.Skip();
00315 
00316     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="class_prof_options_dialog.html#o0">m_chklstModules</a>-&gt;GetCount(); i++)
00317     {
00318         <a class="code" href="class_prof_options_dialog.html#o0">m_chklstModules</a>-&gt;Check(i, <span class="keyword">true</span>);
00319     }
00320 }
00321 
00322 
<a name="l00327"></a><a class="code" href="class_prof_options_dialog.html#a7">00327</a> <span class="keywordtype">void</span> <a class="code" href="class_prof_options_dialog.html#a7">ProfOptionsDialog::OnDecodeClick</a>( wxCommandEvent&amp; event )
00328 {
00329     <span class="comment">// Insert custom code here</span>
00330     event.Skip();
00331 
00332     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="class_prof_options_dialog.html#o0">m_chklstModules</a>-&gt;GetCount(); i++)
00333     {
00334         <a class="code" href="class_prof_options_dialog.html#o0">m_chklstModules</a>-&gt;Check(i, <span class="keyword">false</span>);
00335     }
00336 
00337     wxString stringToDecode = <a class="code" href="class_prof_options_dialog.html#o7">m_txtDecode</a>-&gt;GetValue();
00338 
00339     wxString numberString = stringToDecode.Right(stringToDecode.Len() - 4);
00340     wxString prefixString = stringToDecode.Left(4);
00341 
00342     <a class="code" href="class_cls_crc16.html">ClsCrc16</a> crc;
00343     crc.<a class="code" href="class_cls_crc16.html#a3">CrcInitialize</a>();
00344     crc.<a class="code" href="class_cls_crc16.html#a4">CrcAdd</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(numberString.GetData()), numberString.Len());
00345     wxString generatedCRC;
00346 
00347     generatedCRC.Printf(<span class="stringliteral">"%X"</span>, crc.<a class="code" href="class_cls_crc16.html#a7">CrcGet</a>());
00348 
00349     <span class="keywordflow">if</span>(generatedCRC != prefixString)
00350     {
00351         wxMessageBox(<span class="stringliteral">"Invalid authorization code!"</span>, <span class="stringliteral">"Invalid code"</span>, wxOK | wxICON_WARNING);
00352         <span class="keywordflow">return</span>;
00353     }
00354 
00355     <span class="keywordtype">long</span> numberLong;
00356 
00357     numberString.ToLong(&amp;numberLong);
00358 
00359 
00360     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="datastructures_8h.html#a150a100">PERM_LAST</a>; i++)
00361     {
00362         <a class="code" href="class_prof_options_dialog.html#o0">m_chklstModules</a>-&gt;Check(i, (numberLong &amp; (1 &lt;&lt; i)));
00363     }
00364     
00365 
00366 
00367 
00368 }
00369 
00370 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Apr 28 16:45:38 2004 for Chameleon by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
