<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Chameleon: Crc16.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>Crc16.cpp</h1><a href="_crc16_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//</span>
00002 <span class="comment">// Crc16.cpp</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// (C) Copyright 1999-2000 Jan van den Baard.</span>
00005 <span class="comment">//     All Rights Reserved.</span>
00006 <span class="comment">//</span>
00007 
00008 <span class="preprocessor">#include "<a class="code" href="_crc16_8h.html">crc16.h</a>"</span>
00009 
00010 <span class="preprocessor">#include "<a class="code" href="debug_8h.html">debug.h</a>"</span>
00011 
00012 <span class="preprocessor">#ifdef _DEBUG</span>
00013 <span class="preprocessor"></span><span class="preprocessor">#define new DEBUG_NEW</span>
00014 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00015 <span class="preprocessor"></span>
00016 <span class="comment">// 16 bit CRC table. Generated with a polynomial of 0x1021.</span>
<a name="l00017"></a><a class="code" href="class_cls_crc16.html#t0">00017</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="class_cls_crc16.html#t0">ClsCrc16::s_wCrc16</a>[ 256 ] =
00018 {
00019     0x0000,  0x1021,  0x2042,  0x3063,  0x4084,  0x50a5,  0x60c6,  0x70e7,
00020     0x8108,  0x9129,  0xa14a,  0xb16b,  0xc18c,  0xd1ad,  0xe1ce,  0xf1ef,
00021     0x1231,  0x0210,  0x3273,  0x2252,  0x52b5,  0x4294,  0x72f7,  0x62d6,
00022     0x9339,  0x8318,  0xb37b,  0xa35a,  0xd3bd,  0xc39c,  0xf3ff,  0xe3de,
00023     0x2462,  0x3443,  0x0420,  0x1401,  0x64e6,  0x74c7,  0x44a4,  0x5485,
00024     0xa56a,  0xb54b,  0x8528,  0x9509,  0xe5ee,  0xf5cf,  0xc5ac,  0xd58d,
00025     0x3653,  0x2672,  0x1611,  0x0630,  0x76d7,  0x66f6,  0x5695,  0x46b4,
00026     0xb75b,  0xa77a,  0x9719,  0x8738,  0xf7df,  0xe7fe,  0xd79d,  0xc7bc,
00027     0x48c4,  0x58e5,  0x6886,  0x78a7,  0x0840,  0x1861,  0x2802,  0x3823,
00028     0xc9cc,  0xd9ed,  0xe98e,  0xf9af,  0x8948,  0x9969,  0xa90a,  0xb92b,
00029     0x5af5,  0x4ad4,  0x7ab7,  0x6a96,  0x1a71,  0x0a50,  0x3a33,  0x2a12,
00030     0xdbfd,  0xcbdc,  0xfbbf,  0xeb9e,  0x9b79,  0x8b58,  0xbb3b,  0xab1a,
00031     0x6ca6,  0x7c87,  0x4ce4,  0x5cc5,  0x2c22,  0x3c03,  0x0c60,  0x1c41,
00032     0xedae,  0xfd8f,  0xcdec,  0xddcd,  0xad2a,  0xbd0b,  0x8d68,  0x9d49,
00033     0x7e97,  0x6eb6,  0x5ed5,  0x4ef4,  0x3e13,  0x2e32,  0x1e51,  0x0e70,
00034     0xff9f,  0xefbe,  0xdfdd,  0xcffc,  0xbf1b,  0xaf3a,  0x9f59,  0x8f78,
00035     0x9188,  0x81a9,  0xb1ca,  0xa1eb,  0xd10c,  0xc12d,  0xf14e,  0xe16f,
00036     0x1080,  0x00a1,  0x30c2,  0x20e3,  0x5004,  0x4025,  0x7046,  0x6067,
00037     0x83b9,  0x9398,  0xa3fb,  0xb3da,  0xc33d,  0xd31c,  0xe37f,  0xf35e,
00038     0x02b1,  0x1290,  0x22f3,  0x32d2,  0x4235,  0x5214,  0x6277,  0x7256,
00039     0xb5ea,  0xa5cb,  0x95a8,  0x8589,  0xf56e,  0xe54f,  0xd52c,  0xc50d,
00040     0x34e2,  0x24c3,  0x14a0,  0x0481,  0x7466,  0x6447,  0x5424,  0x4405,
00041     0xa7db,  0xb7fa,  0x8799,  0x97b8,  0xe75f,  0xf77e,  0xc71d,  0xd73c,
00042     0x26d3,  0x36f2,  0x0691,  0x16b0,  0x6657,  0x7676,  0x4615,  0x5634,
00043     0xd94c,  0xc96d,  0xf90e,  0xe92f,  0x99c8,  0x89e9,  0xb98a,  0xa9ab,
00044     0x5844,  0x4865,  0x7806,  0x6827,  0x18c0,  0x08e1,  0x3882,  0x28a3,
00045     0xcb7d,  0xdb5c,  0xeb3f,  0xfb1e,  0x8bf9,  0x9bd8,  0xabbb,  0xbb9a,
00046     0x4a75,  0x5a54,  0x6a37,  0x7a16,  0x0af1,  0x1ad0,  0x2ab3,  0x3a92,
00047     0xfd2e,  0xed0f,  0xdd6c,  0xcd4d,  0xbdaa,  0xad8b,  0x9de8,  0x8dc9,
00048     0x7c26,  0x6c07,  0x5c64,  0x4c45,  0x3ca2,  0x2c83,  0x1ce0,  0x0cc1,
00049     0xef1f,  0xff3e,  0xcf5d,  0xdf7c,  0xaf9b,  0xbfba,  0x8fd9,  0x9ff8,
00050     0x6e17,  0x7e36,  0x4e55,  0x5e74,  0x2e93,  0x3eb2,  0x0ed1,  0x1ef0,
00051 };
00052 
00053 <span class="comment">// Default constructor.</span>
<a name="l00054"></a><a class="code" href="class_cls_crc16.html#a0">00054</a> <a class="code" href="class_cls_crc16.html#a0">ClsCrc16::ClsCrc16</a>()
00055 {
00056     <span class="comment">// Setup the default.</span>
00057     <a class="code" href="class_cls_crc16.html#p1">m_pCrcTable</a> = <a class="code" href="class_cls_crc16.html#p0">m_pCrcAllocated</a> = <a class="code" href="_crc16_8h.html#a0">NULL</a>;
00058     <a class="code" href="class_cls_crc16.html#a3">CrcInitialize</a>();
00059 }
00060 
00061 <span class="comment">// Constructor which you can pass a polynomial used</span>
00062 <span class="comment">// to compute the CRC checksum.</span>
<a name="l00063"></a><a class="code" href="class_cls_crc16.html#a1">00063</a> <a class="code" href="class_cls_crc16.html#a0">ClsCrc16::ClsCrc16</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> wPolynomial )
00064 {
00065     <span class="comment">// Initialize the table.</span>
00066     <a class="code" href="class_cls_crc16.html#p1">m_pCrcTable</a> = <a class="code" href="class_cls_crc16.html#p0">m_pCrcAllocated</a> = <a class="code" href="_crc16_8h.html#a0">NULL</a>;
00067     <a class="code" href="class_cls_crc16.html#a3">CrcInitialize</a>( wPolynomial );
00068 }
00069 
00070 <span class="comment">// Destructor.</span>
<a name="l00071"></a><a class="code" href="class_cls_crc16.html#a2">00071</a> <a class="code" href="class_cls_crc16.html#a2">ClsCrc16::~ClsCrc16</a>()
00072 {
00073     <span class="comment">// Cleanup custom table if used.</span>
00074     <span class="keywordflow">if</span> ( <a class="code" href="class_cls_crc16.html#p0">m_pCrcAllocated</a> ) <span class="keyword">delete</span> [] <a class="code" href="class_cls_crc16.html#p0">m_pCrcAllocated</a>;
00075 }
00076 
00077 <span class="comment">// Initialize the CRC table.</span>
<a name="l00078"></a><a class="code" href="class_cls_crc16.html#a3">00078</a> <span class="keywordtype">void</span> <a class="code" href="class_cls_crc16.html#a3">ClsCrc16::CrcInitialize</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> wPolynomial <span class="comment">/* = 0x1021 */</span> )
00079 {
00080     <span class="comment">// Default the checksum.</span>
00081     <a class="code" href="class_cls_crc16.html#p2">m_sCRC</a> = 0xFFFF;
00082 
00083     <span class="comment">// Does the polynomial differ from the default?</span>
00084     <span class="keywordflow">if</span> ( wPolynomial != 0x1021 )
00085     {
00086         <span class="comment">// Allocate table if necessary.</span>
00087         <span class="keywordflow">if</span> ( <a class="code" href="class_cls_crc16.html#p0">m_pCrcAllocated</a> == <a class="code" href="_crc16_8h.html#a0">NULL</a> ) <a class="code" href="class_cls_crc16.html#p0">m_pCrcAllocated</a> = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>[ 256 ];
00088 
00089         <span class="comment">// Generate CRC table entries.</span>
00090         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> i = 0; i &lt;= 255; i++ )
00091         {
00092             <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> crc = ( <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> )( i &lt;&lt; 8 );
00093             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j = 8; j &gt; 0; j-- )
00094             {
00095                 <span class="keywordflow">if</span>( crc &amp; 0x8000 ) crc = ( <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> )(( crc &lt;&lt; 1 ) ^ wPolynomial );
00096                 <span class="keywordflow">else</span>           crc &lt;&lt;= 1;
00097             }
00098             <a class="code" href="class_cls_crc16.html#p0">m_pCrcAllocated</a>[ i ] = ( <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> )( crc &amp; 0xFFFF );
00099         }
00100 
00101         <span class="comment">// Store table pointer.</span>
00102         <a class="code" href="class_cls_crc16.html#p1">m_pCrcTable</a> = <a class="code" href="class_cls_crc16.html#p0">m_pCrcAllocated</a>;
00103     }
00104     <span class="keywordflow">else</span>
00105         <span class="comment">// Use the build-in table.</span>
00106         <a class="code" href="class_cls_crc16.html#p1">m_pCrcTable</a> = &amp;<a class="code" href="class_cls_crc16.html#t0">s_wCrc16</a>[ 0 ];
00107 }
00108 
00109 <span class="comment">// Add this chunk of data</span>
00110 <span class="comment">// to the already existing CRC value.</span>
<a name="l00111"></a><a class="code" href="class_cls_crc16.html#a4">00111</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="class_cls_crc16.html#a4">ClsCrc16::CrcAdd</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* pData, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> dwLength )
00112 {
00113     <span class="comment">// Must be a valid pointer.</span>
00114     <span class="keywordflow">if</span> ( pData == 0L ) 
00115         <span class="keywordflow">return</span> 0;
00116 
00117     <span class="comment">// Compute CRC.</span>
00118     <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i = 0; i &lt; dwLength; i++ )
00119         <a class="code" href="class_cls_crc16.html#p2">m_sCRC</a> = ( <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> )(( <a class="code" href="class_cls_crc16.html#p1">m_pCrcTable</a>[ (( <a class="code" href="class_cls_crc16.html#p2">m_sCRC</a> ) ^ ( *pData++ )) &amp; 0xFF ] ^ (( <a class="code" href="class_cls_crc16.html#p2">m_sCRC</a> ) &gt;&gt; 8 )));
00120 
00121     <span class="keywordflow">return</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> )( <a class="code" href="class_cls_crc16.html#p2">m_sCRC</a> ^ 0xFFFF );
00122 }
00123 
00124 <span class="comment">// Compute CRC for this block of data.</span>
<a name="l00125"></a><a class="code" href="class_cls_crc16.html#a5">00125</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="class_cls_crc16.html#a5">ClsCrc16::Crc</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* pData, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> dwLength )
00126 {
00127     <span class="comment">// Must be a valid pointer.</span>
00128     <span class="keywordflow">if</span> ( pData == 0L ) 
00129         <span class="keywordflow">return</span> 0;
00130 
00131     <span class="comment">// Reset CRC value.</span>
00132     <a class="code" href="class_cls_crc16.html#p2">m_sCRC</a> = 0xFFFF;
00133 
00134     <span class="comment">// Compute CRC.</span>
00135     <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i = 0; i &lt; dwLength; i++ )
00136         <a class="code" href="class_cls_crc16.html#p2">m_sCRC</a> = ( <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> )(( <a class="code" href="class_cls_crc16.html#p1">m_pCrcTable</a>[ (( <a class="code" href="class_cls_crc16.html#p2">m_sCRC</a> ) ^ ( *pData++ )) &amp; 0xFF ] ^ (( <a class="code" href="class_cls_crc16.html#p2">m_sCRC</a> ) &gt;&gt; 8 )));
00137 
00138     <span class="keywordflow">return</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> )( <a class="code" href="class_cls_crc16.html#p2">m_sCRC</a> ^ 0xFFFF );
00139 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Apr 28 16:45:38 2004 for Chameleon by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
